{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-lg border border-sky-100 py-4 px-4 md:px-6 mt-[0px] sm:mt-[8px] md:mt-[8px]">

  <!-- ì²« ì¤„: ì•„ì´ì½˜ + íƒ€ì´í‹€ ì •ë ¬ -->
  <div class="flex items-center justify-center md:justify-start gap-2 mb-3">
      <i data-lucide="user-plus" class="w-7 h-7 text-sky-700"></i>
      <span class="text-sky-800 font-bold text-xl md:text-2xl">ì§ì› ë“±ë¡</span>
  </div>

  <form method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-5">
    
    <!-- âœ… ë¶€ì„œ + ì•„ì´ë”” : ê°™ì€ ì¤„ 2ì»¬ëŸ¼, ì •ë ¬ ë§ì¶”ê¸° -->
    <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-5">
      
      <!-- ì™¼ìª½: ë¶€ì„œ -->
      {% if is_superadmin %}
      <div>
        <label class="block text-sm font-medium text-slate-600 mb-1">ë¶€ì„œ</label>
        <div class="relative">
          <select name="department" required
                  class="appearance-none w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 pr-8 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition">
            <option value="">-- ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
            {% for d in dept_list %}
              <option value="{{ d }}">{{ d }}</option>
            {% endfor %}
          </select>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               class="absolute right-2.5 top-1/2 transform -translate-y-1/2 w-4 h-4 text-sky-500 pointer-events-none">
            <path d="m6 9 6 6 6-6" />
          </svg>
        </div>
      </div>
      {% else %}
      <div>
        <label class="block text-sm font-medium text-slate-600 mb-1">ë¶€ì„œ</label>
        <input type="text" value="{{ current_dept }}" disabled
               class="w-full border border-sky-100 rounded-lg px-3 py-2 text-sm bg-slate-50 text-slate-600 shadow-inner">
        <input type="hidden" name="department" value="{{ current_dept }}">
      </div>
      {% endif %}

      <!-- ì˜¤ë¥¸ìª½: ì•„ì´ë”” -->
      <div>
        <label class="block text-sm font-medium text-slate-600 mb-1">ì•„ì´ë””</label>
        <input type="text" name="username" id="usernameInput"
               autocomplete="off"
               class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition" required>
        <p id="usernameMsg" class="text-xs mt-1 text-slate-500"></p>
      </div>

    </div>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ -->
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-600 mb-1">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" name="password"
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition" required>
    </div>

    <!-- âœ… ì„± / ì´ë¦„ -->
    <div>
      <label class="block text-sm font-medium text-slate-600 mb-1">ì„±</label>
      <input type="text" name="last_name"
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-slate-600 mb-1">ì´ë¦„</label>
      <input type="text" name="first_name"
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition" required>
    </div>

    <!-- âœ… ì…ì‚¬ì¼ + ìƒì¼ -->
    <div>
      <label class="block text-sm font-medium text-slate-600 mb-1">ì…ì‚¬ì¼</label>
      <input type="date" name="join_date"
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-slate-600 mb-1">ìƒì¼</label>
      <input type="date" name="birthday"
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition">
    </div>

    <!-- âœ… ì£¼ì†Œ -->
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-600 mb-1">ì£¼ì†Œ</label>
      <input type="text" name="address"
             placeholder="ì˜ˆ: OOë„ OOì‹œ OOêµ¬ OOë™ ê¹Œì§€ë§Œ..."
             class="w-full border border-sky-200 bg-gradient-to-r from-sky-50 to-white rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:border-sky-400 transition">
    </div>

    <!-- âœ… ë²„íŠ¼ -->
    <div class="md:col-span-2 flex justify-between items-center mt-6">
      <a href="{{ url_for('employee.employee_list') }}"
         class="text-slate-500 hover:text-sky-600 text-sm">â† ëŒì•„ê°€ê¸°</a>
      <button type="submit"
              class="bg-sky-600 hover:bg-sky-700 text-white text-sm font-medium px-6 py-2 rounded-lg shadow-md transition">
        ì§ì› ë“±ë¡
      </button>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("usernameInput");
  const msg = document.getElementById("usernameMsg");

  if (!input || !msg) return;

  let timer = null;
  const checkUrl = "{{ url_for('employee.check_username') }}";  // ğŸ”¹ ë¸”ë£¨í”„ë¦°íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©

  input.addEventListener("input", () => {
    const val = input.value.trim();

    if (!val) {
      msg.textContent = "";
      msg.className = "text-xs mt-1 text-slate-500";
      return;
    }

    if (timer) clearTimeout(timer);

    timer = setTimeout(async () => {
      try {
        // ğŸ”¹ GET ë°©ì‹ìœ¼ë¡œ ì¿¼ë¦¬ ì „ì†¡
        const res = await fetch(`${checkUrl}?username=${encodeURIComponent(val)}`);

        if (!res.ok) {
          console.warn("ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ ì‹¤íŒ¨:", res.status);
          return;
        }

        const data = await res.json();

        if (data.exists) {
          msg.textContent = "âš  ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
          msg.className = "text-xs mt-1 text-red-600";
        } else {
          msg.textContent = "âœ“ ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
          msg.className = "text-xs mt-1 text-emerald-600";
        }
      } catch (err) {
        console.error("ì¤‘ë³µ ì²´í¬ ì¤‘ ì˜¤ë¥˜:", err);
      }
    }, 400);
  });
});
</script>

{% endblock %}
