{% extends "base.html" %}
{% block title %}ê°€ìì—°ì„¸ë³‘ì› ì—°ì°¨ê´€ë¦¬ ì‹œìŠ¤í…œ{% endblock %}
{% block content %}
<div class="max-w-5xl mx-auto mt-1 pb-6 space-y-3">
  <!-- ìƒë‹¨ ì¹´ë“œ -->
  <div
    class="max-w-md sm:max-w-lg md:max-w-1xl lg:max-w-1xl
           mx-auto bg-white/90 rounded-3xl shadow-lg border border-sky-100
           px-4 py-3 sm:px-6 sm:py-5
           flex flex-col items-center text-center
           mt-[4px] sm:mt-[8px] md:mt-[8px]"
    style="isolation: isolate;">
    <!-- ì œëª© -->
    <div class="flex items-center justify-center gap-2">
      {% if current_user.is_superadmin or dept_list %}
        <div class="flex flex-col items-center gap-2">
          <!-- ì²« ì¤„: ì•„ì´ì½˜ + íƒ€ì´í‹€ ì •ë ¬ -->
            <div class="flex items-center justify-center md:justify-start gap-2 mb-3">
                <i data-lucide="calendar-days" class="w-7 h-7 text-sky-700"></i>
                <span class="text-sky-800 font-bold text-xl md:text-2xl">ë¶€ì„œë³„ íœ´ê°€ ìº˜ë¦°ë”</span>
            </div>


          <!-- ğŸ”½ ë¶€ì„œ ì„ íƒ ë“œë¡­ë°•ìŠ¤ -->
          <div class="flex items-center gap-2 mb-2">
            <label for="deptSelect" class="text-[16px] text-slate-600">ë¶€ì„œ ì„ íƒ:</label>
            <select id="deptSelect"
              class="border border-sky-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-sky-400 focus:outline-none">
              {% for d in dept_list %}
                <option value="{{ d }}" {% if d == dept %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
            </select>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", function() {
                const select = document.getElementById("deptSelect");
                if (!select) return;

                select.addEventListener("change", function() {
                const selected = this.value || "";
                // ğŸ”¹ ë¸”ë£¨í”„ë¦°íŠ¸ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì´ë™í•˜ë„ë¡ ë³€ê²½
                const baseUrl = "{{ url_for('calendar.calendar_page') }}";
                window.location.href = `${baseUrl}?dept=${encodeURIComponent(selected)}`;
                });
            });
          </script>

        </div>
      {% else %}
        <!-- ğŸ“± ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ¨ê¸°ê³ , md ì´ìƒì—ì„œë§Œ ë³´ì´ê²Œ -->
        <div class="hidden md:flex items-center justify-center md:justify-start gap-2 mb-3">
          <i data-lucide="calendar-days" class="w-7 h-7 text-sky-700"></i>
          <span class="text-sky-800 font-bold text-xl md:text-2xl">
            {{ dept }} íœ´ê°€ ìº˜ë¦°ë”
          </span>
        </div>
      {% endif %}

    </div>

    {% if not current_user.is_superadmin %}
    <p class="text-sky-600 font-semibold flex items-center justify-center gap-1 mt-0 mb-1 md:mb-3 text-lg">
        <span class="align-middle leading-none">{{ username }}</span>
        <span class="text-slate-500 text-base align-middle leading-none">({{ user_dept }})</span>

    </p>
    {% endif %}


    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="flex justify-center gap-2 mt-1 md:mt-2 flex-wrap">
      {% if current_user.is_admin or current_user.is_superadmin %}
      <!-- í”„ë¦°íŠ¸ ë²„íŠ¼ -->
      <button id="exportExcelBtn"
        class="flex items-center gap-1 bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-full transition">
        <i data-lucide="printer" class="w-5 h-5"></i>
        <span class="hidden md:inline">ê·¼ë¬´í‘œ ì¶œë ¥</span>
      </button>

      <!-- ì „ì²´/ë‚´ ì¼ì • í† ê¸€ ë²„íŠ¼ -->
      <button id="toggleViewBtn"
        class="flex items-center gap-1 bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-full transition">
        <i id="toggleIcon" data-lucide="calendar-days" class="w-5 h-5"></i>
        <span id="toggleText" class="hidden md:inline">ì „ì²´ ì¼ì •</span>
      </button>

      <!-- ì‹ ì²­ëŒ€ê¸° ë²„íŠ¼ -->
      <button id="pendingPageBtn"
        class="flex items-center gap-1 bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-full transition">
        <i data-lucide="clipboard-list" class="w-5 h-5"></i>
        <span class="hidden md:inline">ì‹ ì²­ëŒ€ê¸°</span>
      </button>
      {% else %}
      <button id="toggleViewBtn"
        class="flex items-center gap-1 bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded-full transition">
        <i id="toggleIcon" data-lucide="calendar-days" class="w-5 h-5"></i>
        <span id="toggleText" class="hidden md:inline">ì „ì²´ ì¼ì •</span>
      </button>
      {% endif %}
    </div>
        <!-- ğŸ“± ëª¨ë°”ì¼ ì „ìš©: íœ´ê°€ ì¢…ë¥˜ ìƒ‰ìƒ ì•ˆë‚´ ë±ƒì§€ -->
    <div class="mt-2 flex flex-wrap justify-center gap-1 text-[11px] text-slate-600 md:hidden">
      <span class="px-2 py-0.5 rounded-full bg-red-500 text-white">ì—°ì°¨</span>
      <span class="px-2 py-0.5 rounded-full bg-orange-500 text-white">ë°˜ì°¨</span>
      <span class="px-2 py-0.5 rounded-full bg-yellow-400 text-slate-800">ë°˜ë°˜ì°¨</span>
      <span class="px-2 py-0.5 rounded-full bg-emerald-500 text-white">ë³‘ê°€</span>
      <span class="px-2 py-0.5 rounded-full bg-indigo-500 text-white">ì˜ˆë¹„êµ°</span>
      <span class="px-2 py-0.5 rounded-full bg-purple-500 text-white">í† ì—°ì°¨</span>
    </div>
  </div>

  <div id="calendar-wrapper"
      class="rounded-2xl shadow-md border border-sky-100 bg-white/90 backdrop-blur
            pt-1 pb-2 px-2 sm:pt-2 sm:pb-3 sm:px-4 mt-2">
    <div id="calendar" class="w-full"></div>
  </div>

</div>

<!-- âœ… ê´€ë¦¬ì í†µí•© íƒ­ ëª¨ë‹¬ (ë·°í¬íŠ¸ ì¤‘ì•™ + íšŒìƒ‰ ë°˜íˆ¬ëª… ë°°ê²½) -->
<div id="adminModal"
     class="hidden fixed inset-0 z-50 bg-black/40 flex items-center justify-center px-3">
  <div class="bg-white rounded-2xl shadow-2xl p-5 w-full max-w-md text-center">
    <h2 class="text-xl font-semibold mb-3">ì¼ì • ê´€ë¦¬</h2>

    <!-- ğŸ”¹ íƒ­ ë©”ë‰´ -->
    <div class="flex justify-center mb-4 border-b">
      <button id="tabVacation" class="flex-1 py-2 border-b-2 border-sky-500 font-semibold text-sky-600">
        íœ´ê°€ ì§€ì •
      </button>
      <button id="tabWorker" class="flex-1 py-2 border-b-2 border-transparent text-gray-500 hover:text-sky-600">
        ê·¼ë¬´ì ì§€ì •
      </button>
      <button id="tabFlex" class="flex-1 py-2 border-b-2 border-transparent text-gray-500 hover:text-sky-600">
        íƒ„ë ¥ê·¼ë¬´
      </button>
    </div>

    <!-- ğŸ”¹ ë‚ ì§œ í‘œì‹œ -->
    <p id="adminModalDate" class="text-sm text-slate-500 mb-3"></p>

    <!-- ğŸŸ¢ íƒ­ 1: íœ´ê°€ ì§€ì • -->
    <div id="vacationTab">
      <h3 class="text-base font-semibold mb-2">íœ´ê°€ ì¢…ë¥˜</h3>
      {% if dept == "ì˜ë£Œì§„" %}
        <div class="text-left mb-3">
          <label class="text-sm text-slate-600">ì˜ë£Œì§„ ì„ íƒ</label>
          <select id="medicalUser"
            class="w-full mt-1 border border-sky-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:outline-none">
            {% for name in user_names %}
              <option value="{{ name }}">{{ name }}</option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      <div class="flex flex-wrap justify-center gap-2 mb-4">
        <button class="vac-btn flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-700 py-1 px-2 rounded" data-type="ì—°ì°¨">ì—°ì°¨</button>
        <button class="vac-btn flex items-center justify-center bg-orange-100 hover:bg-orange-200 text-orange-700 py-1 px-2 rounded" data-type="ë°˜ì°¨(ì „)">ë°˜ì°¨(ì „)</button>
        <button class="vac-btn flex items-center justify-center bg-orange-100 hover:bg-orange-200 text-orange-700 py-1 px-2 rounded" data-type="ë°˜ì°¨(í›„)">ë°˜ì°¨(í›„)</button>
        <button class="vac-btn flex items-center justify-center bg-yellow-100 hover:bg-yellow-200 text-yellow-700 py-1 px-2 rounded" data-type="ë°˜ë°˜ì°¨">ë°˜ë°˜ì°¨</button>
        <button class="vac-btn flex items-center justify-center bg-emerald-100 hover:bg-emerald-200 text-emerald-700 py-1 px-2 rounded" data-type="ë³‘ê°€">ë³‘ê°€</button>
        <button class="vac-btn flex items-center justify-center bg-indigo-100 hover:bg-indigo-200 text-indigo-700 py-1 px-2 rounded" data-type="ì˜ˆë¹„êµ°">ì˜ˆë¹„êµ°</button>
        <button class="vac-btn flex items-center justify-center bg-purple-100 hover:bg-purple-200 text-purple-700 py-1 px-2 rounded" data-type="í† ì—°ì°¨">í† ì—°ì°¨</button>
      
        {% if dept == "ì˜ë£Œì§„" %}
          <button class="vac-btn flex items-center justify-center bg-sky-100 hover:bg-sky-200 text-sky-700 py-1 px-2 rounded"
                  data-type="ì¼ì •">ì¼ì •</button>
        {% endif %}
      </div>

      {% if dept == "ì˜ë£Œì§„" %}
          <div id="scheduleFields" class="hidden mt-3 text-left space-y-2">
            <div>
              <label class="text-sm text-slate-600">ë©”ëª¨</label>
              <input id="scheduleMemo"
                class="w-full mt-1 border border-sky-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:outline-none"
                placeholder="ë©”ëª¨(ì„ íƒ)" />
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="text-sm text-slate-600">ì‹œì‘</label>
                <select id="scheduleStart"
                  class="w-full mt-1 border border-sky-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:outline-none"></select>
              </div>
              <div>
                <label class="text-sm text-slate-600">ì¢…ë£Œ</label>
                <select id="scheduleEnd"
                  class="w-full mt-1 border border-sky-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 focus:outline-none"></select>
              </div>
            </div>
          </div>
        {% endif %}
    </div>

    <!-- ğŸŸ  íƒ­ 2: ê·¼ë¬´ì ì§€ì • -->
    <div id="workerTab" class="hidden">
      <h3 class="text-base font-semibold mb-2">ê·¼ë¬´ì ì„ íƒ</h3>
      <div class="grid grid-cols-2 gap-2 mb-3">
        {% for name in user_names %}
        <button class="worker-btn bg-blue-100 hover:bg-blue-200 text-blue-700 py-1 rounded" data-name="{{ name }}">
          {{ name }}
        </button>
        {% endfor %}
      </div>
    </div>

    <!-- ğŸŸ£ íƒ­ 3: íƒ„ë ¥ê·¼ë¬´ -->
    <div id="flexTab" class="hidden">
      <h3 class="text-base font-semibold mb-2">íƒ„ë ¥ê·¼ë¬´ ì§€ì •</h3>

      <select id="flexUser" class="border rounded w-full mb-2 p-1 text-sm">
        <option disabled selected>ì§ì› ì„ íƒ</option>
        {% for name in user_names %}
        <option value="{{ name }}">{{ name }}</option>
        {% endfor %}
      </select>

      <select id="flexHours" class="border rounded w-full p-1 text-sm">
        {% for h in range(-10, 11) %}
        <option value="{{ h/2 }}">{{ '%+.1f' | format(h/2) }} ì‹œê°„</option>
        {% endfor %}
      </select>
    </div>

    <!-- ğŸ”¹ ë²„íŠ¼ ì˜ì—­ -->
    <div class="flex gap-2 mt-5">
      <button id="saveAdminEvent" class="flex-1 bg-sky-500 text-white py-2 rounded">ë“±ë¡</button>
      <button id="closeAdminModal" class="flex-1 bg-slate-300 py-2 rounded">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<!-- âœ… ì¼ë°˜ ì‚¬ìš©ì ì „ìš© íœ´ê°€ ì„ íƒ ëª¨ë‹¬ (ë·°í¬íŠ¸ ì¤‘ì•™ + íšŒìƒ‰ ë°˜íˆ¬ëª… ë°°ê²½) -->
<div id="vacationModal"
     class="hidden fixed inset-0 z-50 bg-black/40 flex items-center justify-center px-3">
  <div class="bg-white rounded-2xl shadow-2xl p-5 w-full max-w-xs text-center">
    <h2 class="text-lg font-semibold mb-3">íœ´ê°€ ì„ íƒ</h2>

    <!-- íœ´ê°€ ë²„íŠ¼ë“¤ -->
    <div class="flex flex-wrap justify-center gap-2">
      <button class="vac-btn flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-700 py-1 px-2 rounded" data-type="ì—°ì°¨">ì—°ì°¨</button>
      <button class="vac-btn flex items-center justify-center bg-orange-100 hover:bg-orange-200 text-orange-700 py-1 px-2 rounded" data-type="ë°˜ì°¨(ì „)">ë°˜ì°¨(ì „)</button>
      <button class="vac-btn flex items-center justify-center bg-orange-100 hover:bg-orange-200 text-orange-700 py-1 px-2 rounded" data-type="ë°˜ì°¨(í›„)">ë°˜ì°¨(í›„)</button>
      <button class="vac-btn flex items-center justify-center bg-yellow-100 hover:bg-yellow-200 text-yellow-700 py-1 px-2 rounded" data-type="ë°˜ë°˜ì°¨">ë°˜ë°˜ì°¨</button>
      <button class="vac-btn flex items-center justify-center bg-emerald-100 hover:bg-emerald-200 text-emerald-700 py-1 px-2 rounded" data-type="ë³‘ê°€">ë³‘ê°€</button>
      <button class="vac-btn flex items-center justify-center bg-indigo-100 hover:bg-indigo-200 text-indigo-700 py-1 px-2 rounded" data-type="ì˜ˆë¹„êµ°">ì˜ˆë¹„êµ°</button>
      <button class="vac-btn flex items-center justify-center bg-purple-100 hover:bg-purple-200 text-purple-700 py-1 px-2 rounded" data-type="í† ì—°ì°¨">í† ì—°ì°¨</button>
    </div>

    <!-- âœ… ë“±ë¡ & ì·¨ì†Œ ë²„íŠ¼ -->
    <div class="mt-5 flex justify-center gap-3">
      <button id="confirmAddBtn" class="bg-sky-600 text-white px-4 py-2 rounded hover:bg-sky-700 transition">
        ë“±ë¡
      </button>
      <button id="closeModal" class="bg-slate-300 px-4 py-2 rounded hover:bg-slate-400 transition">
        ì·¨ì†Œ
      </button>
    </div>
  </div>
</div>


<!-- âœ… Toast ì•Œë¦¼ ë°•ìŠ¤ -->
<div id="toastBox" class="fixed top-5 left-1/2 transform -translate-x-1/2 hidden z-[9999]">
  <div id="toastMessage"
      class="px-5 py-3 rounded-lg text-white font-medium shadow-lg bg-sky-500 transition-all duration-500">
  </div>
</div>

<!-- âœ… ìŠ¹ì¸ ëŒ€ê¸° ìš”ì²­ ëª¨ë‹¬ -->
<div id="pendingModal" class="hidden fixed inset-0 z-50 bg-black/40 flex items-center justify-center px-3">
  <div class="bg-white rounded-2xl shadow-2xl p-5 w-full max-w-sm sm:max-w-md">
    <h2 class="text-xl font-bold text-sky-800 mb-3 text-center">ìŠ¹ì¸ ëŒ€ê¸° íœ´ê°€ ëª©ë¡</h2>

    <!-- ë‚ ì§œ -->
    <p id="pendingDate" class="text-lg font-bold text-sky-700 text-center mb-4"></p>

    <!-- ëª©ë¡ -->
    <div id="pendingList" class="space-y-3 max-h-80 overflow-y-auto w-full"></div>

    <!-- ë‹«ê¸° ë²„íŠ¼ -->
    <div class="mt-5 text-center">
      <button id="closePendingModal" class="bg-slate-300 hover:bg-slate-400 text-slate-800 text-sm font-semibold px-5 py-2.5 rounded-lg">
        ë‹«ê¸°
      </button>
    </div>
  </div>
</div>

<!-- âœ… ì¼ì • ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div id="confirmDeleteModal"
    class="hidden fixed inset-0 bg-black/40 z-50 flex items-center justify-center px-4">
  <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-xs text-center">
    <p id="confirmDeleteText" class="text-slate-700 text-base mb-5 font-semibold">
      ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
    </p>
    <div class="flex justify-center gap-3">
      <button id="confirmDeleteYes"
              class="bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-lg font-bold">
        ì‚­ì œ
      </button>
      <button id="confirmDeleteNo"
              class="bg-slate-300 hover:bg-slate-400 text-slate-800 px-5 py-2 rounded-lg font-semibold">
        ì·¨ì†Œ
      </button>
    </div>
  </div>
</div>

<script>
// âœ… í•œêµ­ ê³µíœ´ì¼ ë‹´ì„ ë°°ì—´ & ë¹ ë¥¸ ê²€ìƒ‰ìš© Set
let koreanHolidays = [];          // ë””ë²„ê¹…ìš© (í•„ìˆ˜ëŠ” ì•„ë‹˜)
let koreanHolidaySet = new Set(); // ì—¬ê¸° ì•ˆì— ì—¬ëŸ¬ í•´ ê³µíœ´ì¼ì„ ì „ë¶€ ëˆ„ì  ì €ì¥
let holidayNameMap = {}; // { "2025-10-03": "ê°œì²œì ˆ" } í˜•ì‹ìœ¼ë¡œ ì´ë¦„ ì €ì¥

// âœ… ì´ë¯¸ ë¶ˆëŸ¬ì˜¨ ì—°ë„ë“¤ + ë¡œë”© ìƒíƒœ
let loadedHolidayYears = new Set();
let holidayLoading = false;

// âœ… ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (ì—°ë„ë³„ë¡œ ë”± 1ë²ˆë§Œ í˜¸ì¶œë˜ê²Œ)
async function loadKoreanHolidays(year) {
  // ì´ë¯¸ ì´ ì—°ë„ëŠ” ë¶ˆëŸ¬ì™”ê±°ë‚˜ ì§€ê¸ˆ ë¡œë”© ì¤‘ì´ë©´ ìŠ¤í‚µ
  if (loadedHolidayYears.has(year) || holidayLoading) {
    return false;   // ì´ë²ˆ í˜¸ì¶œì—ì„œ ìƒˆë¡œ ë¡œë”©í•œ ê±´ ì—†ìŒ
  }

  holidayLoading = true;
  try {
    const baseUrl = "{{ url_for('calendar_api.get_holidays', year=0) }}";
    const url = baseUrl.replace("0", year);

    const res = await axios.get(url);

    const rawList  = (res.data && res.data.holidays) || [];
    const nameMap  = (res.data && res.data.holiday_names) || {};

    rawList.forEach((s) => {
      const d = String(s).trim();
      if (!d) return;

      koreanHolidays.push(d);   // ë””ë²„ê¹…ìš©
      koreanHolidaySet.add(d);  // ë¹ ë¥¸ í¬í•¨ ì²´í¬ìš©
    });

    // ì´ë¦„ ë§µ ëˆ„ì 
    Object.entries(nameMap).forEach(([date, name]) => {
      holidayNameMap[date] = name;
    });

    loadedHolidayYears.add(year);

    console.log(`âœ… ${year}ë…„ ê³µíœ´ì¼ ë¡œë”© ì™„ë£Œ. ëˆ„ì  ê°œìˆ˜:`, koreanHolidaySet.size);
    return true;
  } catch (err) {
    console.error("âŒ ê³µíœ´ì¼ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
    return false;
  } finally {
    holidayLoading = false;
  }
}

// âœ… ìŠ¤í¬ë¡¤ ê¸°ì¤€ Toast ì•Œë¦¼ (í™”ë©´ ì¤‘ì•™ ìƒë‹¨ì— ìì—°ìŠ¤ëŸ½ê²Œ ë…¸ì¶œ)
function showToast(message, type = "success") {
  // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
  const existing = document.getElementById("customToast");
  if (existing) existing.remove();

  // ìƒˆ ìš”ì†Œ ìƒì„±
  const toast = document.createElement("div");
  toast.id = "customToast";
  toast.textContent = message;

  // âœ… í˜„ì¬ ìŠ¤í¬ë¡¤ ê¸°ì¤€ ìœ„ì¹˜ ê³„ì‚°
  const scrollY = window.scrollY || document.documentElement.scrollTop;
  const topOffset = scrollY + 100; // í™”ë©´ ìƒë‹¨ì—ì„œ ì•½ê°„ ì•„ë˜

  // ìŠ¤íƒ€ì¼ ì ìš©
  Object.assign(toast.style, {
    position: "absolute",
    top: `${topOffset}px`,
    left: "50%",
    transform: "translateX(-50%)",
    backgroundColor: type === "error" ? "#ef4444" : "#0ea5e9",
    color: "white",
    padding: "10px 16px",
    borderRadius: "8px",
    fontSize: "14px",
    fontWeight: "500",
    boxShadow: "0 2px 10px rgba(0,0,0,0.15)",
    zIndex: "9999",
    opacity: "0",
    transition: "opacity 0.3s ease, transform 0.3s ease",
  });

  document.body.appendChild(toast);

  // ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜
  requestAnimationFrame(() => {
    toast.style.opacity = "1";
    toast.style.transform = "translate(-50%, 10px)";
  });

  // 2.5ì´ˆ í›„ ì‚¬ë¼ì§
  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transform = "translate(-50%, -10px)";
    setTimeout(() => toast.remove(), 400);
  }, 2500);
}


   // âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ì‚½ì… (Flask â†’ JS)
const currentDept = "{{ dept }}".trim();
const isAdmin = ("{{ 'true' if current_user.is_admin or current_user.department.strip() == 'ê´€ë¦¬ì' else 'false' }}" === "true");
const currentUserName = "{{ current_user.first_name or current_user.name or current_user.username }}";
console.log("âœ… isAdmin =", isAdmin, " / dept =", currentDept);

window.__isSuperadmin = ("{{ 'true' if current_user.is_superadmin else 'false' }}" === "true");
window.__monthLocked = false;      // í˜„ì¬ ë³´ê³  ìˆëŠ” ë‹¬ â€œí™•ì •(ì ê¸ˆ)â€ ì—¬ë¶€
window.__canConfirmMonth = false;  // 1~5ì¼ ê¸°ê°„ ì—¬ë¶€(í™•ì • ë²„íŠ¼ í™œì„± ì¡°ê±´)

let selectedDate = null;
let selectedType = null;
let selectedWorkers = []; // ì—¬ëŸ¬ ê·¼ë¬´ì ì„ íƒìš©

document.addEventListener("DOMContentLoaded", async function () {
  const isMobile = window.innerWidth < 768;

  // âœ… ëª¨ë‹¬ ìš”ì†Œ
  const adminModal = document.getElementById("adminModal");
  const adminModalDate = document.getElementById("adminModalDate");
  const saveAdminEvent = document.getElementById("saveAdminEvent");
  const closeAdminModal = document.getElementById("closeAdminModal");

  // âœ… íƒ­ ê´€ë ¨ ìš”ì†Œ
  const tabVacation = document.getElementById("tabVacation");
  const tabWorker = document.getElementById("tabWorker");
  const tabFlex = document.getElementById("tabFlex");
  const vacationTab = document.getElementById("vacationTab");
  const workerTab = document.getElementById("workerTab");
  const flexTab = document.getElementById("flexTab");

  // âœ… ë‹¬ë ¥ ìš”ì†Œ
  const calendarEl = document.getElementById("calendar");
  if (!calendarEl) {
    console.error("âŒ calendar element not found!");
    return;
  }

  // âœ… ì‹œê°„ ì˜µì…˜ ì±„ìš°ê¸° (30ë¶„ ë‹¨ìœ„)
  function fillTimeOptions(selectEl) {
    if (!selectEl) return;
    selectEl.innerHTML = "";
    for (let h = 0; h < 24; h++) {
      for (let m = 0; m < 60; m += 30) {
        const hh = String(h).padStart(2, "0");
        const mm = String(m).padStart(2, "0");
        const v = `${hh}:${mm}`;
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        selectEl.appendChild(opt);
      }
    }
  }

  // âœ… ì˜ë£Œì§„ ì¼ì • ì…ë ¥ ìš”ì†Œê°€ ìˆìœ¼ë©´ ì˜µì…˜ ì±„ìš°ê¸°
  const scheduleStart = document.getElementById("scheduleStart");
  const scheduleEnd = document.getElementById("scheduleEnd");
  if (scheduleStart && scheduleEnd) {
    fillTimeOptions(scheduleStart);
    fillTimeOptions(scheduleEnd);
    scheduleStart.value = "08:00";
    scheduleEnd.value = "17:00";
  }

  //ê³µìš© ë¦¬ì…‹ í•¨ìˆ˜
  function resetVacationButtons() {
    document.querySelectorAll(".vac-btn").forEach(btn => {
      btn.classList.remove(
        "ring-4", "ring-2", "ring-sky-400", // â† ë‘êº¼ìš´/ì–‡ì€ í…Œë‘ë¦¬ ì „ë¶€ ì œê±°
        "bg-sky-500", "text-white", "bg-opacity-80" // í˜¹ì‹œ ì„ íƒ ì‹œ ë°°ê²½/ë¶ˆíˆ¬ëª…ë„ ë³€ê²½í–ˆì„ ìˆ˜ë„ ìˆì–´ ê°™ì´ ì œê±°
      );
      // âš ï¸ ê¸°ë³¸ ë°°ê²½ìƒ‰ì€ ë²„íŠ¼ë§ˆë‹¤ ë‹¤ë¦…ë‹ˆë‹¤(ì—°ì°¨=red-100 ë“±). íšŒìƒ‰ì„ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”!
    });
  }

  // âœ… ì „ì—­ ë³€ìˆ˜ (í•¨ìˆ˜ ë°–ì—ì„œ ì„ ì–¸í•´ì•¼ í•¨)
  let showMyOnly = false;

  // âœ… í™•ì • ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (1~5ì¼ë§Œ + ì´ë¯¸ í™•ì •ì´ë©´ ë¹„í™œì„±)
  async function updateConfirmButtonState() {
    const viewDate = calendar.getDate();
    const viewY = viewDate.getFullYear();
    const viewM = viewDate.getMonth() + 1;

    try {
      const res = await axios.get("{{ url_for('calendar.month_lock_status') }}", {
        params: { dept: currentDept, year: viewY, month: viewM }
      });

      // âœ… ì„œë²„ íŒë‹¨ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      window.__monthLocked = !!res.data.locked;
      window.__canConfirmMonth = !!res.data.can_confirm;

      // ë””ë²„ê·¸(í•„ìš”í•˜ë©´ ìœ ì§€)
      console.log("[month_lock_status]", { viewY, viewM, ...res.data });

    } catch (e) {
      console.error("month_lock_status error:", e);
      window.__monthLocked = false;
      window.__canConfirmMonth = false;
    }

    const btn = document.querySelector(".fc-confirmMonth-button");
    if (!btn) return;

    // âœ… í…ìŠ¤íŠ¸ëŠ” í•­ìƒ "í™•ì •" ìœ ì§€
    btn.textContent = "í™•ì •";

    // ìƒíƒœê°’
    const isLocked = !!window.__monthLocked;                 // í™•ì •ë¨(ì ê¹€)
    const isReady  = !isLocked && !!isAdmin && !!window.__canConfirmMonth;  // í™•ì • ê°€ëŠ¥(í™œì„±)

    // âœ… ìƒíƒœ í´ë˜ìŠ¤ (CSSê°€ ìƒ‰ì„ ë‹´ë‹¹)
    btn.classList.toggle("is-confirmed", isLocked); // ì´ˆë¡
    btn.classList.toggle("is-ready", isReady);      // ë…¸ë‘

    // âœ… í™œì„±/ë¹„í™œì„±
    btn.disabled = !isReady;

    // âœ… í™•ì • í•´ì œ ë²„íŠ¼(ì´ê´€ë¦¬ì ì „ìš©)
    const unlockBtn = document.querySelector(".fc-unlockMonth-button");
    if (unlockBtn) {
      const isSuper = window.__isSuperadmin === true;

      const isLocked = !!window.__monthLocked;

      // âœ… ì´ê´€ë¦¬ì + ì ê¹€ì¼ ë•Œë§Œ ë³´ì´ê²Œ
      const showUnlock = isSuper && isLocked;

      unlockBtn.style.display = showUnlock ? "" : "none";
      unlockBtn.disabled = !showUnlock;

      // âœ… ìƒíƒœ í´ë˜ìŠ¤(ìƒ‰ì€ CSSì—ì„œ)
      unlockBtn.classList.toggle("is-enabled", showUnlock);
    } 
  }


  // âœ… FullCalendar ì´ˆê¸°í™”
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    height: "auto",
    locale: "ko",
    editable: false,
    selectable: false,
    // âœ… ë‚ ì§œ ì…€ í‘œì‹œ ì»¤ìŠ¤í„°ë§ˆì´ì§• (ì£¼ë§ + ê³µíœ´ì¼ ìƒ‰ìƒ)
    dayCellContent: function (info) {
        const date   = info.date;
        const day    = date.getDay();        // 0: ì¼, 6: í† 
        const dateNum = date.getDate();

        const year  = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const dayStr = String(date.getDate()).padStart(2, "0");
        const ymd   = `${year}-${month}-${dayStr}`;   // ì˜ˆ: 2025-10-03

        // ê¸°ë³¸ ìƒ‰: í‰ì¼
        let color = "#1e293b";

        // ì¼ìš”ì¼
        if (day === 0) {
            color = "#e11d48";
        }
        // í† ìš”ì¼
        else if (day === 6) {
            color = "#2563eb";
        }

        // ğŸ”¥ í•œêµ­ ê³µíœ´ì¼ì´ë©´ ë¬´ì¡°ê±´ ë¹¨ê°„ìƒ‰ (ìš”ì¼ ìƒê´€ì—†ì´)
        if (koreanHolidaySet.has(ymd)) {
            color = "#e11d48";
        }

        const isMobile = window.innerWidth < 768;

        // ğŸ“± ëª¨ë°”ì¼: ìˆ«ìë§Œ ì‘ê²Œ (ì´ë¦„ì€ ì•ˆ ë³´ì´ê²Œ)
        if (isMobile) {
            return {
                html: `<span style="font-size:12px; font-weight:600; color:${color}">${dateNum}ì¼</span>`
            };
        }

        // ğŸ’» PC: ê³µíœ´ì¼ì´ë©´ ì´ë¦„ í•œ ì¤„ ë” í‘œì‹œ
        const holidayName = holidayNameMap[ymd] || "";

        if (holidayName) {
            return {
                html: `
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <span style="font-size:14px; font-weight:700; color:${color}">${dateNum}ì¼</span>
                        <span style="font-size:10px; font-weight:600; color:#e11d48; margin-top:2px;">
                            ${holidayName}
                        </span>
                    </div>
                `
            };
        }

    // ê³µíœ´ì¼ì´ ì•„ë‹ ë•ŒëŠ” ì›ë˜ì²˜ëŸ¼ ìˆ«ìë§Œ
    return {
        html: `<span style="font-size:14px; font-weight:700; color:${color}">${dateNum}ì¼</span>`
    };
    },

   // âœ… ê³µíœ´ì¼ + ì¼ìš”ì¼ ë°°ê²½ìƒ‰(ì—°ë¶„í™) ì ìš©
    dayCellDidMount: function (info) {
        const date = info.date;

        const year  = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const dayStr = String(date.getDate()).padStart(2, "0");
        const ymd   = `${year}-${month}-${dayStr}`;

        const isSunday   = date.getDay() === 0;
        const isHoliday  = koreanHolidaySet.has(ymd);

        // ğŸ”´ ì¼ìš”ì¼ ë˜ëŠ” ğŸ”´ ë²•ì • ê³µíœ´ì¼ì´ë©´ ë°°ê²½ ì—°ë¶„í™
        if (isSunday || isHoliday) {
            info.el.style.backgroundColor = "#fee2e2";
        }
    },


    // âœ… ìƒë‹¨(ë…„ì›” íƒ€ì´í‹€ ì˜†) í™•ì • ë²„íŠ¼
    customButtons: {
      confirmMonth: {
        text: "í™•ì •",
        click: async function () {
          // ë²„íŠ¼ ìƒíƒœëŠ” ì•„ë˜ updateConfirmButtonState()ì—ì„œ ê´€ë¦¬
          if (!window.__canConfirmMonth) {
            showToast("í™•ì • ê°€ëŠ¥í•œ ê¸°ê°„ì´ ì•„ë‹ˆê±°ë‚˜ ì´ë¯¸ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.", "error");
            return;
          }
          if (!isAdmin) {
            showToast("ê´€ë¦¬ìë§Œ í™•ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
            return;
          }

          const d = calendar.getDate();
          const y = d.getFullYear();
          const m = d.getMonth() + 1;

          try {
            const res = await axios.post("{{ url_for('calendar.month_lock_confirm') }}", {
              dept: currentDept,
              year: y,
              month: m
            });

            showToast(res.data.message || "í™•ì • ì™„ë£Œ");
            await updateConfirmButtonState();     // ë²„íŠ¼/ìƒíƒœ ê°±ì‹ 
            calendar.refetchEvents();             // í•„ìš”ì‹œ ìƒˆë¡œê³ ì¹¨
          } catch (err) {
            const msg = (err.response?.data?.message) || "í™•ì • ì‹¤íŒ¨";
            showToast(msg, "error");
            await updateConfirmButtonState();
          }
        }
      },
      // âœ… ì¶”ê°€: í™•ì • í•´ì œ(ì´ê´€ë¦¬ìë§Œ)
      unlockMonth: {
        text: "í™•ì • í•´ì œ",
        click: async function () {
          const isSuper = window.__isSuperadmin === true;
          if (!isSuper) {
            showToast("ì´ê´€ë¦¬ìë§Œ í™•ì • í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
            return;
          }
          if (!window.__monthLocked) {
            showToast("í™•ì •ëœ ë‹¬ì´ ì•„ë‹™ë‹ˆë‹¤.", "error");
            return;
          }

          if (!confirm("ì •ë§ ì´ ë‹¬ì˜ í™•ì •ì„ í•´ì œí• ê¹Œìš”? (ìˆ˜ì •/ì‚­ì œê°€ ë‹¤ì‹œ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤)")) return;

          const d = calendar.getDate();
          const y = d.getFullYear();
          const m = d.getMonth() + 1;

          try {
            const res = await axios.post("{{ url_for('calendar.month_lock_unlock') }}", {
              dept: currentDept, year: y, month: m
            });

            showToast(res.data.message || "í™•ì • í•´ì œ ì™„ë£Œ");
            await updateConfirmButtonState();
            calendar.refetchEvents();
          } catch (err) {
            showToast((err.response?.data?.message) || "í™•ì • í•´ì œ ì‹¤íŒ¨", "error");
            await updateConfirmButtonState();
          }
        }
      }
    },

    headerToolbar: { left: "", center: "title", right: "" },

    footerToolbar: {
      left: "prev,today,next",
      center: "",
      // âœ… ì›”/ëª©ë¡/í™•ì •(ë¶™ì€ ê·¸ë£¹) + í™•ì •í•´ì œ(ë³„ë„ ë²„íŠ¼) ë¥¼ ì˜¤ë¥¸ìª½ì— ë°°ì¹˜
      right: "dayGridMonth,listWeek,confirmMonth unlockMonth",
    },

    buttonText: { today: "ì˜¤ëŠ˜", month: "ì›”", week: "ì£¼", list: "ëª©ë¡" },

    // âœ… ë‹¬ì´ ë°”ë€” ë•Œë§ˆë‹¤ í™•ì • ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
    datesSet: async function () {
      await updateConfirmButtonState();
    },

    // âœ… ì „ì²´ ì¼ì • / ë‚´ ì¼ì • ì „í™˜ ë°˜ì˜
    events: function (fetchInfo, successCallback, failureCallback) {
      const eventsBase = "{{ url_for('calendar.get_events') }}"; // âœ… í•˜ë“œì½”ë”© ê¸ˆì§€
      const params = new URLSearchParams({ dept: currentDept });

      if (showMyOnly) params.set("my", "1");

      axios.get(`${eventsBase}?${params.toString()}`)
        .then((res) => successCallback(res.data))
        .catch((err) => failureCallback(err));
    },

    eventTimeFormat: {
      hour: "2-digit",
      minute: "2-digit",
      omitZeroMinute: false,
      meridiem: false,
    },

    eventDidMount: function (info) {
        const type = info.event.extendedProps.type || "";
        const timeEl = info.el.querySelector(".fc-list-event-time, .fc-event-time");

        // â° ì‹œê°„ í…ìŠ¤íŠ¸ ì„¸íŒ… (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        if (timeEl) {
            if (type === "ë°˜ì°¨(ì „)") timeEl.textContent = "08:30â€“13:00";
            else if (type === "ë°˜ì°¨(í›„)") timeEl.textContent = "13:00â€“18:00";
            else if (type === "ë°˜ë°˜ì°¨") timeEl.textContent = "2 hour";
            else if (["ì—°ì°¨", "ë³‘ê°€", "ì˜ˆë¹„êµ°"].includes(type)) timeEl.textContent = "all-day";
            else if (type === "íƒ„ë ¥ê·¼ë¬´") {
                const match = info.event.title.match(/\((.*?)\)/);
                timeEl.textContent = match ? match[1] : "flex";
            }
        }

        // âœ… ì œëª©: ëª¨ë°”ì¼ì—ì„œëŠ” ì´ë¦„ë§Œ, PC/íƒœë¸”ë¦¿ì—ì„œëŠ” ì „ì²´ ì œëª©
        const titleEl = info.el.querySelector(".fc-event-title, .fc-list-event-title");
        const originalTitle = info.event.title || "";
        const isMobileView = window.innerWidth < 768;

        if (titleEl) {
            if (isMobileView) {
                const nameOnly = originalTitle.split("(")[0].trim(); // "ì˜¤ë¥œ (ì—°ì°¨)" â†’ "ì˜¤ë¥œ"
                titleEl.textContent = nameOnly;
            } else {
                titleEl.textContent = originalTitle;
            }
        }

        // ===========================
        // âœ… "ì¼ì •"ì€: ìœ¤ì§„(ë©”ëª¨) + ë‹¤ìŒì¤„ ì‹œê°„
        // ===========================
        if (type === "ì¼ì •" && titleEl) {
            const memo = info.event.extendedProps.memo || "";
            const st = info.event.extendedProps.start_time || "";
            const en = info.event.extendedProps.end_time || "";
            const timeRange = (st && en) ? `${st}-${en}` : "";

            // ì´ë¦„ë§Œ ì¶”ì¶œ (ìœ¤ì§„(ì€í–‰)ì—ì„œ ìœ¤ì§„)
            const nameOnly = (info.event.title || "").split("(")[0].trim();

            if (isMobileView) {
                // ëª¨ë°”ì¼ì€ ê¸°ì¡´ ì •ì±…ëŒ€ë¡œ "ì´ë¦„ë§Œ" ìœ ì§€ (ì›í•˜ë©´ ì—¬ê¸°ì„œ ì‹œê°„ë„ í‘œì‹œ ê°€ëŠ¥)
                titleEl.textContent = nameOnly;
            } else {
                // PC/íƒœë¸”ë¦¿: 2ì¤„ ë Œë”ë§
                titleEl.innerHTML = `
                    ${nameOnly}(${memo || "ì¼ì •"})
                    <div class="text-[11px] opacity-90 leading-tight">${timeRange}</div>
                `;

                // ì¤„ë°”ê¿ˆì´ ì‹¤ì œë¡œ ë³´ì´ê²Œ(FullCalendar ê¸°ë³¸ì€ nowrapì¸ ê²½ìš°ê°€ ë§ìŒ)
                titleEl.style.whiteSpace = "normal";
                info.el.style.whiteSpace = "normal";
                info.el.style.height = "auto";
            }
        }


        // âœ… ì—¬ê¸°ë¶€í„°ëŠ” "ëª¨ë°”ì¼ì¼ ë•Œ ë±ƒì§€ ê°„ê²©/ë†’ì´ ê°•ì œ ì¡°ì •" (ì¸ë¼ì¸ ìŠ¤íƒ€ì¼)
        if (isMobileView) {
            const el = info.el;                 // <a class="fc-daygrid-event ...">
            const harness = el.parentElement;   // <div class="fc-daygrid-event-harness">
            const container = harness && harness.parentElement; // <div class="fc-daygrid-day-events">

            // ë±ƒì§€ ìì²´ë¥¼ ì–‡ê³  ì»´íŒ©íŠ¸í•˜ê²Œ
            if (el) {
                el.style.paddingTop = "0px";
                el.style.paddingBottom = "0px";
                el.style.paddingLeft = "2px";
                el.style.paddingRight = "2px";
                el.style.marginTop = "0px";
                el.style.marginBottom = "0px";
                el.style.height = "auto";
                el.style.minHeight = "0";
                el.style.lineHeight = "1";
            }

            // ë±ƒì§€ ì•ˆìª½ í…ìŠ¤íŠ¸ ì˜ì—­ê¹Œì§€ íŒ¨ë”© ì œê±°
            const main = el.querySelector(".fc-event-main");
            if (main) {
                main.style.paddingTop = "0px";
                main.style.paddingBottom = "0px";
                main.style.lineHeight = "1";
                main.style.fontSize = "0.80rem";   // â† ì—¬ê¸° ì¶”ê°€ (0.75rem, 0.7rem ë“± ì·¨í–¥ëŒ€ë¡œ)
            }

            // ê° ì´ë²¤íŠ¸ ë˜í¼ ì‚¬ì´ margin ì œê±°
            if (harness) {
                harness.style.marginTop = "0px";
                harness.style.marginBottom = "0px";
            }

            // ê°™ì€ ë‚ ì§œ ì—¬ëŸ¬ ê°œì¼ ë•Œ "ì„¸ë¡œë¡œ ë”± ë¶™ê²Œ" ì •ë ¬
            if (container && container.classList.contains("fc-daygrid-day-events")) {
                container.style.display = "flex";
                container.style.flexDirection = "column";
                container.style.alignItems = "center";
                container.style.gap = "0px";      // í•„ìš”í•˜ë©´ 1px ì •ë„ë¡œ ë°”ê¿”ë„ ë¨
                container.style.marginTop = "0px";
                container.style.paddingTop = "0px";
            }
        }
    },


    dateClick: function (info) {
      const isSuperadmin = ("{{ 'true' if current_user.is_superadmin else 'false' }}" === "true");
      const isAdmin = ("{{ 'true' if current_user.is_admin else 'false' }}" === "true");

      const day = info.date.getDay(); // 0: ì¼, 6: í† 
      selectedDate = info.dateStr;

      // âœ… í™•ì •(ì ê¸ˆ)ëœ ë‹¬ì´ë©´ (ì´ê´€ë¦¬ì ì œì™¸) ì¶”ê°€/ë³€ê²½ ë¶ˆê°€
      if (window.__monthLocked && !isSuperadmin) {
        showToast("ì´ ë‹¬ì€ í™•ì •ë˜ì–´ íœ´ê°€/ê·¼ë¬´ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
        return;
      }

      const currentDept = "{{ dept }}".trim();
      const userDept = "{{ current_user.department or '' }}".trim();

      // âœ… ì˜ë£Œì§„ ìº˜ë¦°ë”: íƒ€ë¶€ì„œ ì¼ë°˜ì§ì›ì€ ì¡°íšŒë§Œ ê°€ëŠ¥(ë“±ë¡ ëª¨ë‹¬ ê¸ˆì§€)
      if (currentDept === "ì˜ë£Œì§„" && !(isAdmin || isSuperadmin) && userDept !== "ì˜ë£Œì§„") {
        showToast("ì˜ë£Œì§„ ìº˜ë¦°ë”ëŠ” ì¡°íšŒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.", "info");
        return;
      }

      // â­ íœ´ê°€ ë²„íŠ¼ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° â€” ì¼ë°˜ ì§ì›ì—ê²Œë§Œ ì ìš©
      const vacBtns = document.querySelectorAll(".vac-btn");

      const TOYEONCHA_DEPTS = ["ì›ë¬´ê³¼", "ë¬¼ë¦¬ì¹˜ë£Œì‹¤", "ì˜ìƒì˜í•™ê³¼", "ì‹¬ì‚¬ê³¼", "ì™¸ë˜", "ì§„ë‹¨ê²€ì‚¬"];

      // ê´€ë¦¬ì / ìŠˆí¼ê´€ë¦¬ìëŠ” ë²„íŠ¼ ìˆ¨ê¹€ ë¡œì§ì„ ì•„ì˜ˆ ì ìš©í•˜ì§€ ì•ŠìŒ!!
      if (!(isAdmin || isSuperadmin)) {
          vacBtns.forEach(btn => {
              const isToyeoncha = btn.dataset.type === "í† ì—°ì°¨";
              const isDeptAllowed = TOYEONCHA_DEPTS.includes(currentDept);

              // â‘  í† ì—°ì°¨ í—ˆìš© ë¶€ì„œê°€ ì•„ë‹ ë•Œ â†’ ë¬´ì¡°ê±´ ìˆ¨ê¹€
              if (!isDeptAllowed) {
                  btn.style.display = isToyeoncha ? "none" : "inline-flex";
                  return;
              }

              // â‘¡ í—ˆìš© ë¶€ì„œì¼ ë•Œ
              if (day === 6) {
                  // í† ìš”ì¼ â†’ í† ì—°ì°¨ë§Œ í‘œì‹œ
                  btn.style.display = isToyeoncha ? "inline-flex" : "none";
              } else {
                  // í‰ì¼ â†’ í† ì—°ì°¨ ìˆ¨ê¹€
                  btn.style.display = isToyeoncha ? "none" : "inline-flex";
              }
          });
      }
      // â­ ì—¬ê¸°ê¹Œì§€ â€” ê´€ë¦¬ìì—ê²ŒëŠ” vac-btn ìˆ¨ê¹€ ë¡œì§ì„ ì ˆëŒ€ ì ìš©í•˜ì§€ ì•ŠìŒ

      // â­â­ (B) ê´€ë¦¬ì/ìŠˆí¼ê´€ë¦¬ì ì¶”ê°€ í•„í„° (ì›ë¬´ê³¼ í† ìš”ì¼)
      if ((isAdmin || isSuperadmin) && currentDept === "ì›ë¬´ê³¼" && day === 6) {
          vacBtns.forEach(btn => {
              const isToyeoncha = btn.dataset.type === "í† ì—°ì°¨";
              btn.style.display = isToyeoncha ? "inline-flex" : "none";
          });
      }

      selectedType = null;
      selectedWorkers = [];

      const today = new Date();
      const todayZero = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const clickedDate = new Date(info.dateStr);

      // ğŸ”¹ ì¼ë°˜ ì§ì›: ì´ë¯¸ ë‚´ íœ´ê°€ê°€ ìˆëŠ” ë‚ ì§œë©´ ëª¨ë‹¬ ì—´ì§€ ì•ŠìŒ
      if (!(isAdmin || isSuperadmin)) {
          const clickedDateObj = new Date(info.dateStr + "T00:00:00");
          const vacationTypes = ["ì—°ì°¨","ë°˜ì°¨(ì „)","ë°˜ì°¨(í›„)","ë°˜ë°˜ì°¨","ë³‘ê°€","ì˜ˆë¹„êµ°","í† ì—°ì°¨"];

          const hasMyVacation = calendar.getEvents().some(ev => {
              const type = ev.extendedProps.type || "";
              if (!vacationTypes.includes(type)) return false;

              const title = ev.title || "";
              const nameFromTitle = (title.split("(")[0] || "").trim();
              if (nameFromTitle !== currentUserName) return false;

              // all-day ì´ë²¤íŠ¸: end ê°€ ë‹¤ìŒë‚  00ì‹œë¼ì„œ 1ms ë¹¼ì„œ ë‚ ì§œ ë¹„êµ
              const start = new Date(ev.start.getFullYear(), ev.start.getMonth(), ev.start.getDate());
              let endBase = ev.end ? new Date(ev.end.getTime() - 1) : ev.start;
              const end = new Date(endBase.getFullYear(), endBase.getMonth(), endBase.getDate());

              return start <= clickedDateObj && clickedDateObj <= end;
          });

          if (hasMyVacation) {
              showToast("ì´ë¯¸ ì´ ë‚ ì§œì— ë“±ë¡ëœ íœ´ê°€ê°€ ìˆìŠµë‹ˆë‹¤.", "error");
              return; // â›” ëª¨ë‹¬ ì—´ì§€ ì•Šê³  ì¢…ë£Œ
          }
      }

      // ğŸŸ¦ ê´€ë¦¬ì í´ë¦­ ì²˜ë¦¬
      if (isAdmin || isSuperadmin) {

          // â­ ì›ë¬´ê³¼ ê´€ë¦¬ì + í† ìš”ì¼ â†’ ê´€ë¦¬ì ëª¨ë‹¬ (ìœ„ì—ì„œ í† ì—°ì°¨ë§Œ ë³´ì´ë„ë¡ í•„í„°ë§ë¨)
          if (currentDept === "ì›ë¬´ê³¼" && day === 6) {
              document.querySelector(".bottom-nav")?.classList.add("hidden");
              openAdminModal(selectedDate);
              return;
          }

          // â­ ê·¸ ì™¸ â†’ ê¸°ì¡´ ê´€ë¦¬ì ëª¨ë‹¬
          document.querySelector(".bottom-nav")?.classList.add("hidden");
          openAdminModal(selectedDate);
          return;
      }

      // ğŸ”¹ ì¼ë°˜ ì‚¬ìš©ì í† ìš”ì¼ ë¡œì§
      if (day === 6 && !(isAdmin || isSuperadmin)) {
        const allowedDepts = ["ì›ë¬´ê³¼", "ë¬¼ë¦¬ì¹˜ë£Œì‹¤", "ì˜ìƒì˜í•™ê³¼", "ì‹¬ì‚¬ê³¼", "ì™¸ë˜", "ì§„ë‹¨ê²€ì‚¬"];

        if (allowedDepts.includes(currentDept)) {
            // í—ˆìš© ë¶€ì„œ ì¼ë°˜ ì§ì›ì€ í† ì—°ì°¨ ì‹ ì²­ ê°€ëŠ¥
            openVacationModal();
            return;
        }

        // í—ˆìš©ë˜ì§€ ì•Šì€ ë¶€ì„œ
        showToast("í† ìš”ì¼ íœ´ê°€/ê·¼ë¬´ ì§€ì •ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.", "error");
        return;
      }


      // ğŸ”¹ ê³¼ê±° ë‚ ì§œ ê¸ˆì§€
      if (clickedDate < todayZero) {
        showToast("ê³¼ê±° ë‚ ì§œì—ëŠ” íœ´ê°€ë¥¼ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
        return;
      }

      // ğŸ”¹ ì¼ë°˜ ì‚¬ìš©ì ëª¨ë‹¬ í‘œì‹œ
      openVacationModal();
    },



    // ===============================================
    // âœ… FullCalendar eventClick (ìŠ¹ì¸/ì‚­ì œ ëª¨ë‘ í¬í•¨)
    // ===============================================
    eventClick: async function (info) {

        // -----------------------------
        // ğŸ”¥ í•„ìˆ˜ ë³€ìˆ˜
        // -----------------------------
        const eventId = info.event.id;
        const eventStart = info.event.startStr;
        const eventTitle = info.event.title || "";
        const eventType = info.event.extendedProps.type || "";
        const approved = String(info.event.extendedProps.approved).toLowerCase() === "true";

        // ê´€ë¦¬ì ì—¬ë¶€
        const isAdmin =
            ("{{ 'true' if current_user.is_admin or current_user.is_superadmin else 'false' }}" === "true");

        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ëŒ ì´ë¦„
        const currentUserName = "{{ current_user.first_name or current_user.name or current_user.username }}";

        // ì œëª©ì—ì„œ ì´ë¦„ë§Œ ì¶”ì¶œ: "í™ê¸¸ë™ (ì—°ì°¨)" â†’ "í™ê¸¸ë™"
        const nameFromTitle = (eventTitle.split("(")[0] || "").trim();

        // ì´ ì¼ì •ì´ 'ë‚´ ê²ƒ'ì¸ì§€ ì—¬ë¶€
        const isMine = (nameFromTitle === currentUserName);

        // âœ… í™•ì •(ì ê¸ˆ)ëœ ë‹¬ì´ë©´ (ì´ê´€ë¦¬ì ì œì™¸) ìŠ¹ì¸/ì‚­ì œ/ì·¨ì†Œ/ìˆ˜ì • ì§„ì… ê¸ˆì§€
        const isSuperadmin = ("{{ 'true' if current_user.is_superadmin else 'false' }}" === "true");

        if (window.__monthLocked && !isSuperadmin) {
            showToast("ì´ ë‹¬ì€ í™•ì •ë˜ì–´ ìˆ˜ì •/ì‚­ì œ/ìŠ¹ì¸ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
            return;
        }

        // -----------------------------
        // ğŸ”¥ ìŠ¹ì¸ ëŒ€ìƒ íœ´ê°€ ì¢…ë¥˜ë§Œ ìŠ¹ì¸ ëª¨ë‹¬ ê°€ëŠ¥
        // -----------------------------
        const isVacationType = [
            "ì—°ì°¨",
            "ë°˜ì°¨(ì „)",
            "ë°˜ì°¨(í›„)",
            "ë°˜ë°˜ì°¨",
            "ë³‘ê°€",
            "ì˜ˆë¹„êµ°",
            "í† ì—°ì°¨"
        ].includes(eventType);

        // ============================================
        // ğŸ”µ ìŠ¹ì¸ ëŒ€ê¸° ì¼ì • â†’ ê´€ë¦¬ìë§Œ ìŠ¹ì¸ ëª¨ë‹¬ ë„ìš°ê¸°
        // ============================================
        if (isVacationType && !approved && isAdmin) {
            // (ì—¬ê¸° ì•„ë˜ëŠ” ê¸°ì¡´ ìŠ¹ì¸ ëª¨ë‹¬ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€)
            const myDept = "{{ (current_user.department or '') }}".trim();   // ë¡œê·¸ì¸í•œ ë‚´ ë¶€ì„œ
            const isSuper = ("{{ 'true' if current_user.is_superadmin else 'false' }}" === "true");

            const deptForPending = isSuper ? currentDept : myDept;

            const pendingUrl =
            "{{ url_for('calendar.pending_requests', date='__DATE__') }}"
                .replace("__DATE__", eventStart)
            + `?dept=${encodeURIComponent(deptForPending)}`;

            console.log("ğŸ”µ ìŠ¹ì¸ ìš”ì²­ ì¡°íšŒ:", pendingUrl);

            const res = await axios.get(pendingUrl);
            const data = res.data.requests || [];

            const listBox = document.getElementById("pendingList");
            const modal = document.getElementById("pendingModal");
            const dateLabel = document.getElementById("pendingDate");

            listBox.innerHTML = "";
            dateLabel.textContent = eventStart;

            if (data.length === 0) {
                listBox.innerHTML =
                    `<p class='text-slate-500 text-sm text-center'>ìŠ¹ì¸ ëŒ€ê¸° ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            } else {
                data.forEach(req => {
                    const item = document.createElement("div");
                    item.className = "p-2 w-full";

                    // ğŸ”¹ ì‹ ì²­ì¼ì—ì„œ ë…„ë„ ì œê±°
                    const created = req.created_at || "";
                    let displayCreated = created;
                    if (created.length >= 10) {
                        displayCreated = created.slice(5);
                    }

                    item.innerHTML = `
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between
                                    border border-slate-300 rounded-xl px-4 py-2.5 shadow-sm bg-white w-full">

                            <div class="flex flex-wrap justify-center sm:justify-start items-center
                                        gap-1 sm:gap-2
                                        text-base sm:text-lg text-slate-700
                                        text-center sm:text-left">
                                <span class="font-bold sm:text-xl">${req.name}</span>
                                <span class="text-slate-600">/ ${req.type}</span>
                                <span class="text-slate-400 text-sm">(${displayCreated})</span>
                            </div>

                            <div class="flex justify-center sm:justify-end gap-2 mt-2 sm:mt-0">
                                <button
                                    class="approve-btn bg-sky-500 hover:bg-sky-600 text-white text-sm font-semibold px-4 py-2 rounded-lg shadow-sm"
                                    data-id="${req.id}"
                                >ìŠ¹ì¸</button>

                                <button
                                    class="reject-btn bg-red-500 hover:bg-red-600 text-white text-sm font-semibold px-4 py-2 rounded-lg shadow-sm"
                                    data-id="${req.id}"
                                >ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                    listBox.appendChild(item);
                });
            }
            modal.classList.remove("hidden");

            document.getElementById("closePendingModal").onclick = () =>
                modal.classList.add("hidden");

            listBox.onclick = async (e) => {
                const id = e.target.dataset.id;
                if (!id) return;

                if (e.target.classList.contains("approve-btn")) {
                    const approveBase = "{{ url_for('calendar.approve_request', event_id=0) }}";
                    const approveUrl = approveBase.replace("/0", `/${id}`);
                    await axios.post(approveUrl);
                    showToast("âœ… ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
                else if (e.target.classList.contains("reject-btn")) {
                    const rejectBase = "{{ url_for('calendar.reject_request', event_id=0) }}";
                    const rejectUrl = rejectBase.replace("/0", `/${id}`);
                    await axios.post(rejectUrl);
                    showToast("ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                }

                modal.classList.add("hidden");
                calendar.refetchEvents();
            };

            return; // ì—¬ê¸°ì„œ ì¢…ë£Œ (ì‚­ì œ ëª¨ë‹¬ë¡œ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ)
        }

        // ============================================
        // ğŸ”’ ì¼ë°˜ ì‚¬ìš©ì ì‚­ì œ ê¶Œí•œ ì²´í¬
        // ============================================
        if (!isAdmin) {
            // 1) ë‹¤ë¥¸ ì§ì› ì¼ì • â†’ ë°”ë¡œ 'ê¶Œí•œ ì—†ìŒ'
            if (!isMine) {
                showToast("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", "error");
                return;
            }
        }

        // ============================================
        // ğŸ”´ ì—¬ê¸°ê¹Œì§€ í†µê³¼í•œ ê²½ìš°ë§Œ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë„ìš°ê¸°
        // ============================================
        const confirmModal = document.getElementById("confirmDeleteModal");
        const confirmText = document.getElementById("confirmDeleteText");
        const yesBtn = document.getElementById("confirmDeleteYes");
        const noBtn = document.getElementById("confirmDeleteNo");

        let mobileMsg = `"${eventTitle}" ì¼ì •ì„<br>ì‚­ì œí• ê¹Œìš”?`;
        let desktopMsg = `"${eventTitle}" ì¼ì •ì„ ì‚­ì œí• ê¹Œìš”?`;

        if (!approved && !isAdmin) {
            mobileMsg = `"${eventTitle}" ì‹ ì²­ì„<br>ì·¨ì†Œí• ê¹Œìš”?`;
            desktopMsg = `"${eventTitle}" ì‹ ì²­ì„ ì·¨ì†Œí• ê¹Œìš”?`;
        }

        confirmText.innerHTML = `
            <span class="inline sm:hidden">
                ${mobileMsg}
            </span>
            <span class="hidden sm:inline">
                ${desktopMsg}
            </span>
        `;
        confirmModal.classList.remove("hidden");

        yesBtn.onclick = async () => {
            confirmModal.classList.add("hidden");

            try {
                const deleteUrl =
                    "{{ url_for('vacation.delete_event', event_id=0) }}".replace("0", eventId);

                const res = await axios.delete(deleteUrl);
                const data = res.data || {};

                if (res.status === 200 && data.status === "success") {
                    const msg = data.message
                        || (!approved && !isAdmin ? "ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤." : "ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    showToast(msg);
                    await calendar.refetchEvents();
                } else {
                    const msg = data.message || "ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                    showToast(msg, "error");
                    await calendar.refetchEvents();
                }

            } catch (err) {
                console.error("âŒ ì„œë²„ ì˜¤ë¥˜:", err);

                // ğŸ”¥ 403ì´ë©´ 'ê¶Œí•œ ì—†ìŒ' ë©”ì‹œì§€ë¡œ ë³´ì—¬ì£¼ê¸°
                if (err.response && err.response.status === 403) {
                    const msg = (err.response.data && err.response.data.message)
                        || "ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.";
                    showToast(msg, "error");
                } else {
                    showToast("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ", "error");
                }
            }
        };

        noBtn.onclick = () => {
            confirmModal.classList.add("hidden");
        };
    }

  });

  // âœ… ì²˜ìŒì— ì—¬ëŸ¬ í•´ ê³µíœ´ì¼ì„ í•œêº¼ë²ˆì— ë¯¸ë¦¬ ë¡œë”© (í˜„ì¬ ë…„ë„ ê¸°ì¤€ -1 ~ +3ë…„)
  const baseYear = calendar.getDate().getFullYear();
  for (let y = baseYear - 1; y <= baseYear + 2; y++) {
    await loadKoreanHolidays(y);
  }

  // âœ… ê³µíœ´ì¼ ë°ì´í„°ê°€ ì¤€ë¹„ëœ ìƒíƒœì—ì„œ í•œ ë²ˆë§Œ ë Œë”
  calendar.render();

  // âœ… ìµœì´ˆ 1íšŒ í™•ì • ë²„íŠ¼ ìƒíƒœ ì„¸íŒ…
  await updateConfirmButtonState();

  // â­ ê·¼ë¬´í‘œ ì¶œë ¥ ë²„íŠ¼ - ë‹¨ì¼ ì´ë²¤íŠ¸ë§Œ ë“±ë¡
  document.getElementById("exportExcelBtn")?.addEventListener("click", () => {
      const dept = "{{ dept }}".trim();
      if (!dept) {
          showToast("ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
          return;
      }

      const currentDate = calendar.getDate();
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth() + 1;

      // ğŸ“Œ ë¸”ë£¨í”„ë¦°íŠ¸ ë¼ìš°íŠ¸ ê²½ë¡œë¡œ ìˆ˜ì •
      window.location.href = `/schedule/export/${encodeURIComponent(dept)}?year=${year}&month=${month}`;
  });



  // âœ… ì „ì²´ ì¼ì • â†” ë‚´ ì¼ì • í† ê¸€
  const toggleBtn = document.getElementById("toggleViewBtn");
  const toggleText = document.getElementById("toggleText");
  const toggleIcon = document.getElementById("toggleIcon");

  if (toggleBtn && toggleIcon) {
    let showMyOnly = false;

    toggleBtn.addEventListener("click", () => {
      showMyOnly = !showMyOnly;

      // âœ… í…ìŠ¤íŠ¸ ë³€ê²½ (PC ì „ìš©)
      if (toggleText) {
        toggleText.textContent = showMyOnly ? "ë‚´ ì¼ì •" : "ì „ì²´ ì¼ì •";
      }

      // âœ… ìƒ‰ìƒ ì „í™˜ (ì•„ì´ì½˜ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬)
      if (showMyOnly) {
        toggleBtn.classList.remove("bg-sky-600", "hover:bg-sky-700");
        toggleBtn.classList.add("bg-slate-400", "hover:bg-slate-500");
      } else {
        toggleBtn.classList.remove("bg-slate-400", "hover:bg-slate-500");
        toggleBtn.classList.add("bg-sky-600", "hover:bg-sky-700");
      }

      // âœ… ì•„ì´ì½˜ ë³€ê²½ (lucide ë¦¬ë Œë” í¬í•¨)
      const newIcon = showMyOnly ? "user" : "calendar-days";
      // ğŸ”¹ ê¸°ì¡´ SVG ì™„ì „íˆ ì œê±°í•˜ê³  ìƒˆ ì•„ì´ì½˜ ì¬ìƒì„± (lucide ì—…ë°ì´íŠ¸ ë¬¸ì œ í•´ê²°)
      // ğŸ”¹ ê¸°ì¡´ ì•„ì´ì½˜ ì™„ì „ ì´ˆê¸°í™” (SVG ì”ì¡´ ë¬¸ì œ ë°©ì§€)
      toggleIcon.replaceWith(toggleIcon.cloneNode(false));

      // ğŸ”¹ ë‹¤ì‹œ ìš”ì†Œë¥¼ ì°¾ì•„ ìƒˆ data-lucide ì†ì„± ë¶€ì—¬
      const newIconEl = document.getElementById("toggleIcon");
      newIconEl.setAttribute("data-lucide", newIcon);

        // ğŸ”¹ ë Œë”ë§ ì¬ì‹¤í–‰
        setTimeout(() => lucide.createIcons(), 10);
      // âœ… ì´ë²¤íŠ¸ ì†ŒìŠ¤ êµì²´
      const eventsBase = "{{ url_for('calendar.get_events') }}";
      const dept = "{{ dept }}".trim();

      const params = new URLSearchParams({ dept });
      if (showMyOnly) params.set("my", "1");

      const newUrl = `${eventsBase}?${params.toString()}`;

      calendar.removeAllEventSources();
      calendar.addEventSource(newUrl);
      calendar.refetchEvents();
    });
  }


  // âœ… íƒ­ ì „í™˜ í•¨ìˆ˜
  function showTab(tabName) {
    [vacationTab, workerTab, flexTab].forEach(t => t.classList.add("hidden"));
    [tabVacation, tabWorker, tabFlex].forEach(b => b.classList.remove("border-sky-500", "text-sky-600"));
    if (tabName === "vacation") {
      vacationTab.classList.remove("hidden");
      tabVacation.classList.add("border-sky-500", "text-sky-600");
    } else if (tabName === "worker") {
      workerTab.classList.remove("hidden");
      tabWorker.classList.add("border-sky-500", "text-sky-600");
    } else {
      flexTab.classList.remove("hidden");
      tabFlex.classList.add("border-sky-500", "text-sky-600");
    }
  }

  // âœ… íƒ­ í´ë¦­ ì´ë²¤íŠ¸
  tabVacation.addEventListener("click", () => showTab("vacation"));
  tabWorker.addEventListener("click", () => showTab("worker"));
  tabFlex.addEventListener("click", () => showTab("flex"));

  // âœ… ê´€ë¦¬ì ëª¨ë‹¬(íœ´ê°€ íƒ­) ë²„íŠ¼ë§Œ: ì„ íƒ í‘œì‹œ + 'ì¼ì •' ì…ë ¥ì°½ í† ê¸€
  document.querySelectorAll("#adminModal #vacationTab .vac-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();

      const realBtn = e.currentTarget;
      selectedType = realBtn.getAttribute("data-type");

      // âœ… ê´€ë¦¬ì íœ´ê°€ ë²„íŠ¼ë§Œ í…Œë‘ë¦¬ í‘œì‹œ
      document
        .querySelectorAll("#adminModal #vacationTab .vac-btn")
        .forEach((b) => b.classList.remove("ring-2", "ring-sky-400"));

      realBtn.classList.add("ring-2", "ring-sky-400");

      // âœ… 'ì¼ì •' ì„ íƒ ì‹œì—ë§Œ ì…ë ¥ì°½ í‘œì‹œ
      const scheduleFields = document.getElementById("scheduleFields");
      if (scheduleFields) {
        scheduleFields.classList.toggle("hidden", selectedType !== "ì¼ì •");
      }

      console.log("[admin vacation] selectedType =", selectedType);
    });
  });


    // âœ… ê·¼ë¬´ì ë²„íŠ¼ í´ë¦­ (í† ê¸€ ì„ íƒ + í•´ì œ ê°€ëŠ¥)
    document.querySelectorAll(".worker-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();

            // â­ ë°˜ë“œì‹œ currentTarget ì‚¬ìš©í•´ì•¼ ì •ìƒ ì‘ë™ë¨
            const realBtn = e.currentTarget;
            const name = realBtn.dataset.name;
            if (!name) return;

            if (selectedWorkers.includes(name)) {
                // ì´ë¯¸ ì„ íƒ â†’ í•´ì œ
                selectedWorkers = selectedWorkers.filter((n) => n !== name);
                realBtn.classList.remove("ring-2", "ring-sky-400", "bg-sky-500", "text-white");
                realBtn.classList.add("bg-blue-100", "text-blue-700");
            } else {
            // ìƒˆ ì„ íƒ
                selectedWorkers.push(name);
                realBtn.classList.add("ring-2", "ring-sky-400", "bg-sky-500", "text-white");
                realBtn.classList.remove("bg-blue-100", "text-blue-700");
            }

            console.log("âœ… ì„ íƒëœ ê·¼ë¬´ì:", selectedWorkers);
        });
    });



    // âœ… ê´€ë¦¬ì ë“±ë¡ ë²„íŠ¼ (ë‹¨ì¼ ì •ì˜!)
    saveAdminEvent.addEventListener("click", async () => {

        if (window.__monthLocked && !window.__isSuperadmin) {
          showToast("ì´ ë‹¬ì€ í™•ì •ë˜ì–´ ì¶”ê°€/ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
          return;
        }
        const hours = document.getElementById("flexHours").value;
        const target_name = document.getElementById("flexUser").value;

        try {
            let res;

            // ğŸŸ¢ íœ´ê°€ íƒ­
            if (!vacationTab.classList.contains("hidden") && selectedType) {
              const dept = "{{ dept }}".trim();

              const payload = {
                start: selectedDate,
                end: selectedDate,
                type: selectedType,
                department: dept
              };

              // âœ… ì˜ë£Œì§„ ìº˜ë¦°ë”ì—ì„œë§Œ: ëŒ€ìƒ ì˜ë£Œì§„ ì„ íƒ
              if (dept === "ì˜ë£Œì§„") {
                const medicalUser = document.getElementById("medicalUser");
                const targetName = medicalUser ? (medicalUser.value || "").trim() : "";

                if (!targetName) {
                  showToast("ì˜ë£Œì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
                  return;
                }

                payload.target_name = targetName;

                // âœ… 'ì¼ì •'ì´ë©´ ë©”ëª¨/ì‹œê°„ í¬í•¨
                if (selectedType === "ì¼ì •") {
                  const memo = (document.getElementById("scheduleMemo")?.value || "").trim();
                  const st = document.getElementById("scheduleStart")?.value || "";
                  const en = document.getElementById("scheduleEnd")?.value || "";

                  if (!st || !en) {
                    showToast("ì‹œì‘/ì¢…ë£Œ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
                    return;
                  }
                  if (st >= en) {
                    showToast("ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.", "error");
                    return;
                  }

                  payload.memo = memo;
                  payload.start_time = st;
                  payload.end_time = en;
                }
              } else {
                // âœ… ì˜ë£Œì§„ì´ ì•„ë‹Œ ë¶€ì„œì—ì„œëŠ” ì¼ì • ì„ íƒ ìì²´ë¥¼ ë§‰ê¸°(í”„ë¡ íŠ¸ ì•ˆì „ì¥ì¹˜)
                if (selectedType === "ì¼ì •") {
                  showToast("â€˜ì¼ì •â€™ì€ ì˜ë£Œì§„ ìº˜ë¦°ë”ì—ì„œë§Œ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
                  return;
                }
              }

              res = await axios.post("{{ url_for('vacation.add_event') }}", payload);
            }


            // ğŸŸ  ê·¼ë¬´ì íƒ­
            if (!workerTab.classList.contains("hidden") && selectedWorkers.length > 0) {
                res = await axios.post("{{ url_for('vacation.add_event') }}", {
                    start: selectedDate,
                    end: selectedDate,
                    type: "ê·¼ë¬´ì",
                    worker_names: selectedWorkers,
                    department: "{{ dept }}".trim()
                });
            }

            // ğŸŸ£ íƒ„ë ¥ê·¼ë¬´ íƒ­
            if (!flexTab.classList.contains("hidden") && target_name) {
                const parsedHours = parseFloat(hours);

                if (isNaN(parsedHours) || parsedHours === 0) {
                    showToast("ê·¼ë¬´ ì‹œê°„ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”. (0ì€ ì…ë ¥ ë¶ˆê°€)", "error");
                    return;
                }

                if (parsedHours < -6 || parsedHours > 6) {
                    showToast("ê·¼ë¬´ ì‹œê°„ì€ -5 ~ +5 ì‚¬ì´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
                    return;
                }

                // ğŸ”¥ add_flex_event ëŠ” vacation_bp ì•ˆì— ìˆìœ¼ë¯€ë¡œ url_for ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
                const flexUrl = "{{ url_for('vacation.add_flex_event') }}";

                res = await axios.post(
                    flexUrl,
                    {
                    date: selectedDate,
                    target_name: target_name.trim(),
                    hours: parsedHours,
                    },
                    {
                    headers: { "Content-Type": "application/json" },
                    }
                );
            }

            // âœ… ì„œë²„ ì‘ë‹µ ì²˜ë¦¬
            if (res && res.data) {
                if (res.data.status === "success") {
                    showToast(res.data.message || "ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.", "success");

                    // ğŸ”¹ ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
                    adminModal.classList.add("hidden");

                    // ğŸ”¹ ìˆ¨ê²¼ë˜ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë‹¤ì‹œ í‘œì‹œ
                    document.querySelector(".bottom-nav")?.classList.remove("hidden");

                    // ğŸ”¹ ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
                    calendar.refetchEvents();
                } else if (res.data.status === "error") {
                    showToast(res.data.message || "ì´ë¯¸ ë“±ë¡ëœ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤.", "error");
                } else {
                    showToast("ë“±ë¡ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "info");
                }
            } else {
                showToast("ì„œë²„ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.", "error");
            }


            } catch (err) {
                console.error("âŒ ì˜¤ë¥˜:", err);
                showToast("ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
    });

    // âœ… ê³µìš© ì´ˆê¸°í™” í•¨ìˆ˜ ì •ì˜
    function resetWorkerSelection() {
        selectedWorkers = [];
        document.querySelectorAll(".worker-btn").forEach(btn => {
            btn.classList.remove("ring-2", "ring-sky-400", "bg-sky-500", "text-white");
            btn.classList.add("bg-blue-100", "text-blue-700");
        });
    }

    // âœ… ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
    closeAdminModal.addEventListener("click", () => {
        document.querySelector(".bottom-nav")?.classList.remove("hidden"); // âœ… ëª¨ë‹¬ ë‹«í ë•Œ ë³µì›
        adminModal.classList.add("hidden");
        resetWorkerSelection(); // ğŸ”¹ ë‹«ê¸° ì‹œ ì´ˆê¸°í™”
    });


  // âœ… ì¼ë°˜ ì‚¬ìš©ììš© íœ´ê°€ ë“±ë¡ (ë“±ë¡ ë²„íŠ¼ ë°©ì‹)
  const vacModal = document.getElementById("vacationModal");
  const confirmAddBtn = document.getElementById("confirmAddBtn");
  const closeModalBtn = document.getElementById("closeModal");

  // âœ… ì¼ë°˜ ì‚¬ìš©ì ëª¨ë‹¬ ë²„íŠ¼ë§Œ: ì„ íƒ í‘œì‹œ
  document.querySelectorAll("#vacationModal .vac-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();

      document
        .querySelectorAll("#vacationModal .vac-btn")
        .forEach((b) => b.classList.remove("ring-4", "ring-sky-400"));

      btn.classList.add("ring-4", "ring-sky-400");
      selectedType = btn.dataset.type;

      console.log("[user vacation] selectedType =", selectedType);
    });
  });

  // âœ… ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤ì œ ì €ì¥
  if (confirmAddBtn) {
    confirmAddBtn.addEventListener("click", async () => {

        if (window.__monthLocked && !window.__isSuperadmin) {
          showToast("ì´ ë‹¬ì€ í™•ì •ë˜ì–´ íœ´ê°€ë¥¼ ì¶”ê°€/ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "error");
          return;
        }

        if (!selectedDate || !selectedType) {
            showToast("ë‚ ì§œì™€ íœ´ê°€ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "error");
            return;
        }

        const currentDept = "{{ dept }}".trim();
        const day = new Date(selectedDate).getDay();

        // â­ 1) í† ìš”ì¼ì—ëŠ” ì›ë¬´ê³¼ëŠ” í† ì—°ì°¨ë§Œ ê°€ëŠ¥
        if (day === 6 && currentDept === "ì›ë¬´ê³¼" && selectedType !== "í† ì—°ì°¨") {
            showToast("í† ìš”ì¼ì€ í† ì—°ì°¨ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.", "error");
            return;
        }

        // â­ 2) ì›ë¬´ê³¼ëŠ” í‰ì¼ì— í† ì—°ì°¨ ê¸ˆì§€
        if (currentDept === "ì›ë¬´ê³¼" && selectedType === "í† ì—°ì°¨" && day !== 6) {
            showToast("í† ì—°ì°¨ëŠ” í† ìš”ì¼ì—ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "error");
            return;
        }

        try {
            const res = await axios.post("{{ url_for('vacation.add_event') }}", {
                start: selectedDate,
                end: selectedDate,
                type: selectedType,
                department: currentDept,   // âœ… ì¶”ê°€
            });

            if (res.data.status === "success") {
                showToast(`${selectedType} ë“±ë¡ ì™„ë£Œ`, "success");
                vacModal.classList.add("hidden");
                calendar.refetchEvents();
            } else {
                showToast(res.data.message || "ë“±ë¡ ì‹¤íŒ¨", "error");
            }
        } catch (err) {
            console.error("âŒ ë“±ë¡ ì˜¤ë¥˜:", err);
            showToast("ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }

        // ì´ˆê¸°í™”
        selectedType = null;
        selectedDate = null;
    });
  }


  // âœ… ì·¨ì†Œ ë²„íŠ¼ í´ë¦­
  if (closeModalBtn) {
    closeModalBtn.addEventListener("click", () => vacModal.classList.add("hidden"));
  }

  
  const switchDesktopBtn = document.getElementById("switchDesktopBtn");
  const mainContainer = document.querySelector("main");

  // âœ… ì‹ ì²­ ëŒ€ê¸° ë²„íŠ¼ í´ë¦­ â†’ ì‹ ì²­ ëª©ë¡ í˜ì´ì§€ ì´ë™
  const pendingBtn = document.getElementById("pendingPageBtn");
  if (pendingBtn) {
    pendingBtn.addEventListener("click", () => {
      // ğŸ”¥ Blueprint ì—”ë“œí¬ì¸íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ì´ë™
      window.location.href = "{{ url_for('vacation.pending_vacations') }}";
    });
  }

});

// âœ… ì¼ë°˜ ì‚¬ìš©ì ëª¨ë‹¬ ì—´ê¸° (ë·°í¬íŠ¸ ì¤‘ì•™ì€ CSSê°€ ì²˜ë¦¬)
function openVacationModal() {
  const modal = document.getElementById("vacationModal");
  if (!modal) return;

  // ëª¨ë‹¬ ë³´ì—¬ì£¼ê¸°
  modal.classList.remove("hidden");

  // í˜¹ì‹œ ì˜ˆì „ ì¸ë¼ì¸ ìœ„ì¹˜ ìŠ¤íƒ€ì¼ì´ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ ì´ˆê¸°í™”
  modal.style.top = "";
  modal.style.left = "";
  modal.style.transform = "";
  modal.style.position = "";

  // ë²„íŠ¼ ì„ íƒ íš¨ê³¼ ë¦¬ì…‹
  requestAnimationFrame(() => {
    document.querySelectorAll("#vacationModal .vac-btn").forEach((btn) => {
      btn.classList.remove(
        "bg-sky-500",
        "text-white",
        "ring-2",
        "ring-4",
        "ring-sky-400",
        "bg-opacity-80"
      );
    });
    selectedType = null;
  });
}

// âœ… ê´€ë¦¬ì ëª¨ë‹¬ ì—´ê¸°: ìŠ¤í¬ë¡¤ ê¸°ì¤€ ì¤‘ì•™ ì •ë ¬ + íƒ­/ë‚ ì§œ ì„¸íŒ… + ì„ íƒ ì´ˆê¸°í™”
function openAdminModal(dateStr) {
  const modal = document.getElementById("adminModal");
  const adminModalDate = document.getElementById("adminModalDate");
  if (!modal) return;

  // ë‚ ì§œ í‘œì‹œ
  if (adminModalDate) {
    adminModalDate.textContent = `ë‚ ì§œ: ${dateStr}`;
  }

  // âœ… ì˜ë£Œì§„ ì¼ì • ì…ë ¥ ì´ˆê¸°í™”(ìš”ì†Œê°€ ìˆì„ ë•Œë§Œ)
  const scheduleFields = document.getElementById("scheduleFields");
  if (scheduleFields) scheduleFields.classList.add("hidden");

  const memoEl = document.getElementById("scheduleMemo");
  if (memoEl) memoEl.value = "";

  const stEl = document.getElementById("scheduleStart");
  const enEl = document.getElementById("scheduleEnd");
  if (stEl && enEl) {
    stEl.value = "08:00";
    enEl.value = "17:00";
  }

  // ê³µìš© ì´ˆê¸°í™” (ê·¼ë¬´ì ì„ íƒ ì œê±°)
  if (typeof resetWorkerSelection === "function") {
    resetWorkerSelection();
  }

  // ìš”ì¼ ê³„ì‚°
  const d = new Date(dateStr);
  const day = d.getDay(); // 0:ì¼ ~ 6:í† 
  const currentDept = "{{ dept }}".trim();

  // ê¸°ë³¸ íƒ­ ìë™ ì„ íƒ
  if (typeof showTab === "function") {
    if (day === 0 || day === 6) {
      showTab("worker");   // í† /ì¼ â†’ ê·¼ë¬´ì íƒ­
    } else {
      showTab("vacation"); // í‰ì¼ â†’ íœ´ê°€ íƒ­
    }
  }

  // ==========================
  // â­ íœ´ê°€ ì¢…ë¥˜ ë²„íŠ¼ í•„í„°ë§
  // ==========================
  const TOYEONCHA_DEPTS = ["ì›ë¬´ê³¼", "ë¬¼ë¦¬ì¹˜ë£Œì‹¤", "ì˜ìƒì˜í•™ê³¼", "ì‹¬ì‚¬ê³¼", "ì™¸ë˜", "ì§„ë‹¨ê²€ì‚¬"];
  
  const vacBtns = document.querySelectorAll("#vacationTab .vac-btn");
  
  vacBtns.forEach(btn => {
      const isToyeoncha = btn.dataset.type === "í† ì—°ì°¨";
      const isDeptAllowed = TOYEONCHA_DEPTS.includes(currentDept);
  
      // â‘  í† ì—°ì°¨ í—ˆìš© ë¶€ì„œê°€ ì•„ë‹ ë•Œ â†’ ë¬´ì¡°ê±´ ìˆ¨ê¹€
      if (!isDeptAllowed) {
          btn.style.display = isToyeoncha ? "none" : "inline-flex";
          return;
      }
  
      // â‘¡ í† ì—°ì°¨ í—ˆìš© ë¶€ì„œì¼ ë•Œ
      if (day === 6) {
          // í† ìš”ì¼ â†’ í† ì—°ì°¨ë§Œ í‘œì‹œ
          btn.style.display = isToyeoncha ? "inline-flex" : "none";
      } else {
          // í‰ì¼ â†’ í† ì—°ì°¨ ìˆ¨ê¹€
          btn.style.display = isToyeoncha ? "none" : "inline-flex";
      }
  });


  // ==========================
  // ëª¨ë‹¬ ë³´ì´ê¸° (ìœ„ì¹˜/ë°°ê²½ì€ CSSë¡œ ì²˜ë¦¬)
  // ==========================
  modal.classList.remove("hidden");

  // ì˜ˆì „ ì¸ë¼ì¸ ìœ„ì¹˜ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
  modal.style.top = "";
  modal.style.left = "";
  modal.style.transform = "";
  modal.style.position = "";

  // 1í”„ë ˆì„ ë’¤ UI ë¦¬ì…‹
  requestAnimationFrame(() => {
    document.querySelectorAll("#adminModal .vac-btn").forEach((btn) => {
      btn.classList.remove(
        "bg-sky-500",
        "text-white",
        "ring-2",
        "ring-4",
        "ring-sky-400",
        "bg-opacity-80"
      );
    });

    selectedType = null;
    selectedWorkers = [];

    document.querySelectorAll(".worker-btn").forEach((btn) => {
      btn.classList.remove("ring-2", "ring-sky-400", "bg-sky-500", "text-white");
      btn.classList.add("bg-blue-100", "text-blue-700");
    });
  });
}

</script>

<style>
    /* ===========================
   âœ… "í™•ì •/í™•ì •ë¨" ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„ 
   - ë” ì‘ê²Œ, ë‘¥ê¸€ê²Œ(pill), íˆ¬ë°•í•¨ ì œê±°
   =========================== */

    /* ë²„íŠ¼ ê·¸ë£¹(FullCalendar ê¸°ë³¸) ì˜í–¥ ì¤„ì´ê¸° */
    .fc .fc-button-group {
      background: transparent !important;
      border: 0 !important;
      box-shadow: none !important;
    }

    /* confirmMonth ë²„íŠ¼ ìì²´ */
    .fc .fc-confirmMonth-button.fc-button {
      border-radius: 0.375rem !important;   /* âœ… pill ì œê±° (rounded-md ëŠë‚Œ) */
      height: auto !important;
      min-height: unset !important;

      /* ë‹¤ë¥¸ fc ë²„íŠ¼ê³¼ ë¹„ìŠ·í•˜ê²Œ */
      padding: 3px 8px !important;
      font-size: 1rem !important;
      line-height: 1.2 !important;

      box-shadow: none !important;
    }

    /* hover ì‹œ ì‚´ì§ ë– ë³´ì´ê²Œ */
    .fc .fc-confirmMonth-button.fc-button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(15,23,42,.14) !important;
    }

    /* ëˆŒë €ì„ ë•Œ */
    .fc .fc-confirmMonth-button.fc-button:active:not(:disabled) {
      transform: translateY(0px);
      box-shadow: 0 1px 2px rgba(15,23,42,.10) !important;
    }

    /* ë¹„í™œì„±(í™•ì • ë¶ˆê°€/í™•ì •ë¨ í¬í•¨)ì¼ ë•Œ ë” â€œì„¸ë ¨ëœâ€ í†¤ìœ¼ë¡œ */
    .fc .fc-confirmMonth-button.fc-button:disabled {
      opacity: 1 !important;               /* (JSì—ì„œ opacity-50 ë¶™ì–´ë„) ë” ê¹”ë”í•˜ê²Œ */
      filter: saturate(0.55);
      box-shadow: none !important;
    }
        /* í—¤ë” ìœ„, í‘¸í„° ë°”ë¡œ ìœ„ë¡œ ëŒì–´ì˜¬ë¦¬ê¸° */
    .fc .fc-header-toolbar {
        order: 0;
    }
    /* âœ… íƒ€ì´í‹€("2025ë…„ 12ì›”") + í™•ì • ë²„íŠ¼ì„ ê°™ì€ ì¤„ë¡œ ê°•ì œ */
    .fc .fc-header-toolbar .fc-toolbar-chunk{
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 10px !important;
      flex-wrap: nowrap !important;
    }

    /* h2 ê¸°ë³¸ margin ë•Œë¬¸ì— ì¤„ë°”ê¿ˆì²˜ëŸ¼ ë³´ì´ëŠ” ê²ƒ ì œê±° */
    .fc .fc-header-toolbar .fc-toolbar-title{
      margin: 0 !important;
      padding: 0 !important;
      white-space: nowrap !important;
    }

    /* í™•ì • ë²„íŠ¼ ê·¸ë£¹ë„ ì˜†ì— ë¶™ê²Œ */
    .fc .fc-header-toolbar .fc-button-group{
      margin: 0 !important;
      white-space: nowrap !important;
    }

    .fc .fc-footer-toolbar {
        margin-top: -0.4rem !important;
        padding-top: 0 !important;
    }
    .fc .fc-view-harness {
        margin-top: 10px !important;     /* ğŸ”¹ ë²„íŠ¼ ì¤„ â†” ë‹¬ë ¥ ì‚¬ì´ ì—¬ë°± */
        margin-bottom: 0 !important;
        order: 2;
    }
    /* âœ… ëª¨ë“  ë·°í¬íŠ¸ ê³µí†µ: ì´ë²¤íŠ¸ ë°•ìŠ¤ë¥¼ ìµœëŒ€í•œ ì–‡ê²Œ */
    .fc-event {
        line-height: 1em !important;      /* ì„¸ë¡œ ê°„ê²© ì¤„ì´ê¸° */
        padding: 0 4px !important;        /* ìœ„/ì•„ë˜ 0, ì¢Œìš°ë§Œ ì•½ê°„ */
        height: auto !important;
        min-height: 0 !important;         /* ë” ì´ìƒ ìµœì†Œ ë†’ì´ ê°•ì œ X */
        white-space: nowrap !important;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.9rem !important;
    }
    /* âœ… 2. ì´ë²¤íŠ¸ ì œëª©(ì´ë¦„) ì˜ì—­ ì—¬ë°± ìµœì†Œí™” */
    .fc-daygrid-event-dot {
        margin: 0 2px 0 0 !important;
    }

    /* âœ… dayGrid ì›” ë³´ê¸°ì—ì„œ ê°™ì€ ë‚ ì§œ ì•ˆì˜ ë±ƒì§€ ê°„ê²©/ë†’ì´ ì¡°ì • (PC+ëª¨ë°”ì¼ ê³µí†µ) */
    .fc .fc-daygrid-day-frame {
        text-align: center;                /* ë‚ ì§œ + ë±ƒì§€ ì¤‘ì•™ ì •ë ¬ */
    }

    .fc .fc-daygrid-day-events {
        display: flex;
        flex-direction: column;            /* ìœ„/ì•„ë˜ë¡œ ìŒ“ê¸° */
        align-items: center;               /* ê°€ë¡œ ê°€ìš´ë° */
        gap: 1px;                          /* ë±ƒì§€ ì‚¬ì´ ê°„ê²© (0~2px ì‚¬ì´ë¡œ ì¡°ì ˆ ê°€ëŠ¥) */
        margin-top: 0;
        padding-top: 0;
    }

    .fc .fc-daygrid-day .fc-daygrid-event-harness {
        margin: 0 !important;              /* ê¸°ë³¸ margin ì œê±° */
    }

    .fc .fc-daygrid-day .fc-daygrid-event {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: auto;
        min-width: 0;
        margin: 0 !important;
        padding: 0 4px;
        height: auto;
        min-height: 0;
        line-height: 1;
        border-radius: 4px;             /* pill ëª¨ì–‘ ìœ ì§€ */
    }

    .fc .fc-daygrid-day .fc-daygrid-event .fc-event-main {
        padding: 0;
        line-height: 1;
    }


    /* âœ… PC ëª¨ë“œì¼ ë•Œ ì „ì²´ ë ˆì´ì•„ì›ƒ í™•ëŒ€ */
    .desktop-view {
      max-width: 900px;
      margin: 0 auto;
      transition: all 0.3s ease;
    }

    /* âœ… PC ëª¨ë“œì¼ ë•Œ ì¹´ë“œ í¬ê¸° ë° í°íŠ¸ ì•½ê°„ í™•ëŒ€ */
    .desktop-view .bg-white\/90 {
      padding: 1.5rem !important;
      font-size: 1.05rem;
    }

    /* âœ… ëª¨ë°”ì¼ ê¸°ë³¸ ìƒíƒœ */
    main:not(.desktop-view) {
      max-width: 100%;
    }

    /* âœ… íˆ´ë°” ì•„ë˜ ìº˜ë¦°ë” ë³¸ë¬¸ ê°„ê²©ë§Œ ì‚´ì§ ì£¼ê¸°
    (ê° ë²„íŠ¼ ê·¸ë£¹ ë†’ì´ëŠ” ëª¨ë‘ ë™ì¼í•˜ê²Œ) */
    .fc .fc-header-toolbar {
        margin-top: 0 !important;         /* ğŸ”¹ íƒ€ì´í‹€ ìœ„ ì—¬ë°± ê±°ì˜ ì—†ê²Œ */
        padding-top: 2px !important;      /* ğŸ”¹ ë„ˆë¬´ ë¶™ì§€ ì•Šê²Œ ì‚´ì§ë§Œ */
        margin-bottom: 0 !important;
    }


    /* âœ… FullCalendar ëª©ë¡(list) ë·° ë¼ìš´ë“œ ì²˜ë¦¬ */
    .fc-theme-standard .fc-list {
      border-radius: 12px !important;
      overflow: hidden !important;
      border: 1px solid #dbeafe !important; /* ìº˜ë¦°ë” ì™¸ê³½ì„  ëŠë‚Œ ìœ ì§€ */
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }

    /* ìº˜ë¦°ë”ì˜ ëª©ë¡í˜• ì´ë²¤íŠ¸ ë°°ê²½çµ±ä¸€ */
    .fc-list-event {
      background-color: #ffffff !important;
    }
    /* âœ… dayGrid ì›” ë³´ê¸°: ê°™ì€ ë‚ ì§œ ì•ˆì˜ ë±ƒì§€ ê°„ê²©/ë†’ì´ ê°•ì œ ì¡°ì • (PC + ëª¨ë°”ì¼ ê³µí†µ) */
    .fc .fc-daygrid-day-frame {
        text-align: center !important; /* ë‚ ì§œ + ë±ƒì§€ ëª¨ë‘ ê°€ìš´ë° */
    }

    .fc .fc-daygrid-day-events {
        display: flex !important;
        flex-direction: column !important;  /* ìœ„â†•ì•„ë˜ë¡œ ìŒ“ì´ê²Œ */
        align-items: center !important;     /* ê°€ë¡œ ê°€ìš´ë° */
        gap: 0 !important;                  /* ë±ƒì§€ ì‚¬ì´ ê°„ê²© 0 */
        margin-top: 0 !important;
        padding-top: 0 !important;
    }

    /* ê° ì´ë²¤íŠ¸ ë˜í¼ ì‚¬ì´ ì—¬ë°± ì œê±° */
    .fc .fc-daygrid-day .fc-daygrid-event-harness {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
    }

    /* ë±ƒì§€ ìì²´ ë†’ì´/ê°„ê²© ìµœì†Œí™” */
    .fc .fc-daygrid-day .fc-daygrid-event {
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        width: auto !important;
        min-width: 0 !important;
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        min-height: 0 !important;          /* ì˜ˆì „ min-height:16 ë®ì–´ì“°ê¸° */
        height: auto !important;
        line-height: 1 !important;
    }

    /* ë±ƒì§€ ì•ˆìª½ í…ìŠ¤íŠ¸ ë°•ìŠ¤ë„ ì„¸ë¡œ ì—¬ë°± ì œê±° */
    .fc .fc-daygrid-day .fc-daygrid-event .fc-event-main {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        line-height: 1 !important;
    }
    /* âœ… ê°™ì€ ë‚ ì§œì—ì„œ ë‘ ë²ˆì§¸ ì´í›„ ë±ƒì§€ëŠ” ì‚´ì§ ìœ„ë¡œ ê²¹ì¹˜ê²Œ (ê°„ê²© ê°•ì œë¡œ ì¤„ì´ê¸°) */
    .fc .fc-daygrid-day .fc-daygrid-event-harness + .fc-daygrid-event-harness {
        margin-top: -4px !important;   /* í•„ìš”í•˜ë©´ -2, -3 ë“±ìœ¼ë¡œ ì¡°ì ˆ */
    }
        /* âœ… ë‚ ì§œ í…ìŠ¤íŠ¸ì™€ ì²« ë²ˆì§¸ ë±ƒì§€ ì‚¬ì´ ê°„ê²© ì¤„ì´ê¸° */
    .fc .fc-daygrid-day .fc-daygrid-day-top {
        padding-bottom: 0 !important;   /* ë‚ ì§œ í–‰ ì•„ë˜ íŒ¨ë”© ì œê±° */
        margin-bottom: -6 !important;    /* ë‚ ì§œ í–‰ ì•„ë˜ ë§ˆì§„ ì œê±° */
    }
    /* ë‚ ì§œ ìˆ«ì "22ì¼" ìì²´ì˜ íŒ¨ë”©/ë§ˆì§„ ì œê±° */
    .fc .fc-daygrid-day-number {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        margin: 0 !important;
        line-height: 1 !important;
    }

    .fc .fc-daygrid-day-frame {
        padding-top: 0 !important;      /* í”„ë ˆì„ ìœ„ìª½ íŒ¨ë”©ë„ 0ìœ¼ë¡œ */
    }

    .fc .fc-daygrid-day-events {
        margin-top: 0 !important;       /* ì´ë²¤íŠ¸ ì˜ì—­ ìœ„ìª½ ì—¬ë°± ì œê±°(ì¬í™•ì¸) */
        padding-top: 0 !important;
    }

    /* âœ… ì˜¤ë¥¸ìª½ ë²„íŠ¼ ê·¸ë£¹(ì›”/ëª©ë¡/í™•ì •) ì™„ì „ ë¶™ì´ê¸° */
    .fc .fc-toolbar .fc-button-group {
      display: inline-flex !important;
      gap: 0 !important;
    }

    .fc .fc-toolbar .fc-button-group > .fc-button {
      margin: 0 !important;                 /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© ì œê±° */
      border-radius: 0 !important;          /* ê°€ìš´ë° ë²„íŠ¼ ë‘¥ê¸€ê¸° ì œê±° */
      border-right: 0 !important;           /* ê²½ê³„ì„  ê²¹ì¹¨ ì œê±° */
      box-shadow: none !important;
      padding: 6px 12px !important;
      font-weight: 700 !important;
    }

    /* âœ… ì–‘ ëë§Œ ë‘¥ê¸€ê²Œ (ë¶™ì€ ì„¸ê·¸ë¨¼íŠ¸ ëŠë‚Œ) */
    .fc .fc-toolbar .fc-button-group > .fc-button:first-child {
      border-top-left-radius: 10px !important;
      border-bottom-left-radius: 10px !important;
    }

    .fc .fc-toolbar .fc-button-group > .fc-button:last-child {
      border-top-right-radius: 10px !important;
      border-bottom-right-radius: 10px !important;
      border-right: 1px solid rgba(15, 23, 42, 0.2) !important; /* ë§ˆì§€ë§‰ë§Œ ê²½ê³„ì„  */
    }

    /* âœ… ê¸°ë³¸(ë¹„í™œì„±) ë²„íŠ¼ í†¤: ì§„í•œ ë„¤ì´ë¹„ */
    .fc .fc-toolbar .fc-button-group > .fc-button {
      background: #243447 !important;  /* slate/navy */
      border: 1px solid rgba(15, 23, 42, 0.2) !important;
      color: #fff !important;
    }

    /* âœ… ì›”/ëª©ë¡: ì„ íƒëœ ë²„íŠ¼ë§Œ ë” ê°•ì¡° (FullCalendarê°€ fc-button-active ë¶€ì—¬) */
    .fc .fc-toolbar .fc-button-group > .fc-button.fc-button-active {
      background: #0ea5e9 !important;  /* sky-500 */
      border-color: #0284c7 !important; /* sky-600 */
      color: #fff !important;
    }

    /* âœ… í™•ì •ë¨ì´ë©´ í´ë¦­ ëª»í•˜ê²Œ í•  ê²½ìš°(ì„ íƒ): ë¹„í™œì„± ìŠ¤íƒ€ì¼ */
    .fc .fc-confirmMonth-button.is-confirmed:disabled {
      opacity: 0.95 !important;
      cursor: default !important;
    }
    /* âœ… ë²„íŠ¼ ê·¸ë£¹ ê¸°ë³¸(ì›”/ëª©ë¡/í™•ì •): ë„¤ì´ë¹„ */
    .fc .fc-toolbar .fc-button-group > .fc-button {
      background: #243447 !important;
      border: 1px solid rgba(15, 23, 42, 0.2) !important;
      color: #fff !important;
    }

    /* âœ… ì„ íƒëœ ë·°(ì›”/ëª©ë¡) ê°•ì¡° */
    .fc .fc-toolbar .fc-button-group > .fc-button.fc-button-active {
      background: #0ea5e9 !important;
      border-color: #0284c7 !important;
    }

    /* âœ… ë¹„í™œì„±(disabled)ì´ì–´ë„ ê¸°ë³¸ ë„¤ì´ë¹„ í†¤ ìœ ì§€ */
    .fc .fc-toolbar .fc-button-group > .fc-button:disabled {
      opacity: 1 !important;
      cursor: not-allowed !important;
      filter: none !important;
    }

    /* âœ… í™•ì • ë²„íŠ¼: "í™œì„±í™”(í™•ì • ê°€ëŠ¥)"ì¼ ë•Œë§Œ ë…¸ë‘ */
    .fc .fc-toolbar .fc-button-group > .fc-confirmMonth-button.is-ready {
      background: #f59e0b !important;   /* amber */
      border-color: #d97706 !important;
    }

    /* âœ… í™•ì • ë²„íŠ¼: "í™•ì •ë¨(ì ê¹€)"ì¼ ë•Œ ì´ˆë¡ */
    .fc .fc-toolbar .fc-button-group > .fc-confirmMonth-button.is-confirmed {
      background: #16a34a !important;   /* green */
      border-color: #15803d !important;
      cursor: default !important;
    }
    /* âœ… í™•ì • í•´ì œ ë²„íŠ¼: ì„¸ê·¸ë¨¼íŠ¸ì™€ ë¶„ë¦¬ëœ danger ë²„íŠ¼ */
    .fc .fc-unlockMonth-button {
      margin-left: 10px !important;         /* ì˜¤ë¥¸ìª½ ì„¸ê·¸ë¨¼íŠ¸ì™€ ê°„ê²© */
      background: #fff !important;
      color: #ef4444 !important;            /* red-500 */
      border: 1px solid #ef4444 !important;
      border-radius: 10px !important;
      font-weight: 800 !important;
      box-shadow: none !important;
    }

    .fc .fc-unlockMonth-button:hover {
      filter: brightness(0.98) !important;
    }


/* ğŸ“± ëª¨ë°”ì¼ ì „ìš©: ì›” ì œëª© + ë„¤ë¹„ ë²„íŠ¼ í¬ê¸° ì¤„ì´ê¸° */
@media (max-width: 768px) {
    /* ğŸ”¹ í—¤ë”(ì œëª© + ë„¤ë¹„ ë²„íŠ¼)ë¥¼ ì„¸ë¡œë¡œ ìŒ“ê³ , ìœ„/ì•„ë˜ ê°„ê²© ì¼ì •í•˜ê²Œ */
    .fc .fc-header-toolbar {
        display: flex;
        flex-direction: column;          /* ì œëª© / ë²„íŠ¼ ì¤„ì„ ì„¸ë¡œë¡œ */
        align-items: center;
        gap: 10px;                        /* ì œëª© â†” ë²„íŠ¼ ì¤„ ê°„ê²© */
        margin-top: 4px !important;
        margin-bottom: 6px !important;   /* ë²„íŠ¼ â†” ë‹¬ë ¥ ë³¸ë¬¸ ê°„ê²© (ìœ„ gapê³¼ ë§ì¶¤) */
        padding-top: 0 !important;
        padding-bottom: 0 !important;
    }

    /* ê° chunk(â†â†’ ì˜¤ëŠ˜ / ì œëª© / ì›”Â·ëª©ë¡) ìì²´ ì—¬ë°± ì œê±° */
    .fc .fc-header-toolbar .fc-toolbar-chunk {
        margin: 0 !important;
    }

    /* "2025ë…„ 11ì›”" ì œëª© ê¸€ì”¨ */
    .fc .fc-toolbar-title {
        font-size: 1.3rem !important;    /* í•„ìš”í•˜ë©´ 1.1 / 1.3 ìœ¼ë¡œ ì¡°ì ˆ */
        line-height: 1.2 !important;
    }

    /* â—€ â–¶ ì˜¤ëŠ˜ / ì›” / ëª©ë¡ ë²„íŠ¼ í¬ê¸° */
    .fc .fc-button {
        padding: 3px 8px !important;     /* ì„¸ë¡œ ì–‡ê²Œ, ê°€ë¡œë„ ì¡°ê¸ˆ ì¤„ì´ê¸° */
        font-size: 1rem !important;    /* ì‚´ì§ ì‘ê²Œ */
        line-height: 1.2 !important;
    }

    .fc .fc-button .fc-icon {
        font-size: 0.9em !important;
    }
}

</style>

{% endblock content%}
